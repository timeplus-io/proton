{
    "test_suite_name": "streaming_only",
    "comments":
        "test_stream_onlys covering the steam query smoke cases for streaming only mode.",
    "test_suite_config": {
        "table_schemas":[
            {
                "name": "test6_stream_only",
                "type": "table",
                "query_parameters":"storage_type=streaming",
                "columns": [
                    {
                        "name": "id",
                        "type": "string"
                    },
                    {
                        "name": "location",
                        "type": "string"
                    },
                    {
                        "name": "value",
                        "type": "float32"
                    },
                    {
                        "name": "json",
                        "type": "string"

                    },
                    {
                        "name": "timestamp",
                        "type": "datetime64(3)",
                        "default": "now64(3)"
                    }
                ],
                "event_time_column":"timestamp"
            },
            {
                "name": "test6_stream_only_no_default_tp_time",
                "type": "table",
                "columns": [
                    {
                        "name": "id",
                        "type": "string"
                    },
                    {
                        "name": "location",
                        "type": "string"
                    },
                    {
                        "name": "value",
                        "type": "float32"
                    },
                    {
                        "name": "json",
                        "type": "string"

                    },
                    {
                        "name": "timestamp",
                        "type": "datetime64(3)",
                        "default": "now64(3)"
                    }
                ]
            },
            {
                "name": "test6_stream_only_seek",
                "type": "table",
                "columns": [
                    {
                        "name": "id",
                        "type": "string"
                    },
                    {
                        "name": "location",
                        "type": "string"
                    },
                    {
                        "name": "value",
                        "type": "float32"
                    },
                    {
                        "name": "json",
                        "type": "string"

                    },
                    {
                        "name": "timestamp",
                        "type": "datetime64(3)",
                        "default": "now64(3)"
                    }
                ],
                "event_time_column":"timestamp"
            },
            {
                "name": "test6_stream_only_d",
                "type": "table",
                "columns": [
                    {
                        "name": "id",
                        "type": "string"
                    },
                    {
                        "name": "type",
                        "type": "string"
                    }

                ]}

        ],
        "setup": {
            "inputs": [
                {"table_name":"test6_stream_only_d", "data": [
                ["dev1", "roof"],
                ["dev2", "field"],
                ["dev3", "window"],
                ["dev4", "wall"],
                ["dev5", "roof"],
                ["dev6", "window"],
                ["dev7", "wall"],
                ["dev8", "floor"]]
                }
            ]
        },
        "tests_2_run": {"ids_2_run": ["all"], "tags_2_run":[], "tags_2_skip":{"default":["todo", "to_support", "change", "bug", "sample","native_not_support", "func rename"],"cluster": ["view", "cluster_table_bug"]}}
    },

    "tests": [
        {
            "id": 0,
            "tags": ["tumble window"],
            "name": "stream tumble window max(value) aggregate group by id, window_start, window_end",
            "description": "tumble window aggregate by max and group by id, window_start, window_end",
            "steps":[
                {"statements": [
                    {"client":"python", "query_id":"601", "depends_on_stream":"test6_stream_only", "run_mode":"process", "query_type": "stream", "terminate":"manual", "query_end_timer": 1, "query":"select id, max(value), window_start, window_end from tumble(test6_stream_only, timestamp, interval 5 second) group by id, window_start, window_end emit stream"},
                    {"client":"python", "query_id":"602", "depends_on_stream":"test6_stream_only", "run_mode":"process", "query_type": "stream", "terminate":"auto","query_end_timer": 1, "query":"select id, max(value), window_start, window_end from tumble(test6_stream_only, timestamp, interval 5 second) group by id, window_start, window_end emit stream"}
                ]},


                {"inputs": [
                    {"table_name": "test6_stream_only", "depends_on":"602", "wait":2, "data": [
                        ["dev1", "ca", 57.3, "\"create_time\":\"2021-11-02 20:00:01\"", "2020-02-02 20:00:00"],
                        ["dev2", "ca", 58.3, "\"create_time\":\"2021-11-02 20:00:10\"", "2020-02-02 20:00:03"]
                    ]},
                    {"table_name": "test6_stream_only", "data": [["dev6", "ca", 66, "\"create_time\":\"2021-11-02 20:00:11\"", "2020-02-02 20:00:04"]]}
                    ,
                    {"table_name": "test6_stream_only", "data": [["dev8", "ca", 67, "\"create_time\":\"2021-11-02 20:00:11\"", "2020-02-02 20:00:10"]]}
                ]},

                {"statements": [
                    {"client":"python", "wait": 4,"depends_on":601, "query_type": "table", "query":"kill query where query_id = '601'"},
                    {"client":"python", "query_type": "table", "query":"select id, max(value) from table(test6_stream_only) group by id, location"}
                ]
                }

            ],

            "expected_results": [
                {"query_id": "601",
                    "expected_results":
                    [["dev2", "58.3", "2020-02-02 20:00:00", "2020-02-02 20:00:05"],
                    ["dev6", "66.0", "2020-02-02 20:00:00", "2020-02-02 20:00:05"],
                    ["dev1", "57.3", "2020-02-02 20:00:00", "2020-02-02 20:00:05"]]
                },
                {"query_id": "602",
                    "expected_results":
                    [["dev2", "58.3", "2020-02-02 20:00:00", "2020-02-02 20:00:05"],
                    ["dev6", "66.0", "2020-02-02 20:00:00", "2020-02-02 20:00:05"],
                    ["dev1", "57.3", "2020-02-02 20:00:00", "2020-02-02 20:00:05"]]
                }

            ]
        },
        {
            "id": 1,
            "tags": ["sytax exception"],
            "name": "stream query expected exception: not under aggregate and not in group",
            "description": "expected exception",
            "steps":[
                {"statements": [
                        {"client":"python", "query_id":"601", "query_type": "stream", "terminate":"auto", "query":"select id, max(value), window_start, window_end from tumble(test6_stream_only, timestamp, interval 5 second) group by window_start, window_end emit stream"}
                ]

                }
            ],
            "expected_results": [{"query_id":"601", "expected_results": "error_code:215"}]
        },
        {
            "id": 2,
            "tags": ["sytax exception", "bug"],
            "name": "stream query expected exception: global stream query w/ PERIODIC INTERVAL but no aggreagation",
            "description": "expected exception",
            "steps": [
                {"statements": [
                    {"client":"python", "query_id":"601", "query_type": "stream", "terminate":"auto", "query":"SELECT * FROM test6_stream_only WHERE value >25 EMIT STREAM PERIODIC INTERVAL 2 SECOND"}
                ]}
            ],

            "expected_results": [{"query_id":"601", "expected_results": "error_code:62"}]
        },
        {
            "id": 3,
            "tags": ["sytax exception"],
            "name": "stream query expected exception: stream query group by w/ both window_start and window_end lacked",
            "description": "expected exception",
            "steps":[
                {"statements": [
                    {"client":"python", "query_id":"601", "query_type": "stream", "terminate":"auto", "query":"select id, max(value) from tumble(test6_stream_only, timestamp, interval 5 second) group by id emit stream after watermark"}
                ]}
            ],

            "expected_results": [{"query_id":"601", "expected_results":"error_code:2002"}]
        },
        {
            "id": 4,
            "tags": ["tumble window"],
            "name": "stream tumble window with designated timestamp w/ out of order timestamp within window.",
            "description": "stream tumble window with designated 5 sec timestamp.",
            "steps":[
                {"statements": [
                    {"client":"python", "query_id":"601", "query_type": "stream", "terminate":"auto", "query_end_timer": 2, "query":"select max(value), window_start, window_end from tumble(test6_stream_only, timestamp, interval 5 second) group by window_start, window_end emit stream"}
                ]},
                {"inputs": [
                    {"table_name":"test6_stream_only","depends_on":"601", "data": [
                        ["dev1", "ca", 57.3, "\"create_time\":\"2021-11-02 20:00:01\"", "2020-02-02 20:00:14"],
                        ["dev2", "ca", 58.3, "\"create_time\":\"2021-11-02 20:00:10\"", "2020-02-02 20:00:13"]
                    ]},

                    {"table_name":"test6_stream_only", "data": [["dev6", "ca", 66, "\"create_time\":\"2021-11-02 20:00:11\"", "2020-02-02 20:00:12"]]}
                    ,
                    {"table_name":"test6_stream_only", "data": [["dev8", "ca", 67, "\"create_time\":\"2021-11-02 20:00:11\"", "2020-02-02 20:00:15"]]}
                ]
                }
            ],
            "expected_results": [{"query_id":"601", "expected_results":
                [["66", "2020-02-02 20:00:10", "2020-02-02 20:00:15"]]}
            ]
        },
        {
            "id": 5,
            "tags": ["tumble window"],
            "name": "stream tumble window w/ 1st batch inputs data cross multiple windows - #104",
            "description": "stream tumble window query and send 3 inptus in the first batch, the window_start of the next window should be based on the minimal timestamp of the first batch",
            "steps": [
                {"statements": [
                    {"client":"python", "query_id":"601", "query_type": "stream","query_end_timer": 1, "query":"select window_start, window_end, max(timestamp), min(timestamp) from tumble(test6_stream_only, timestamp, interval 3 second) where value > 50 group by  window_start, window_end emit stream"}]},
                {"inputs": [
                        {"table_name":"test6_stream_only", "wait":1, "depends_on":"601","data": [
                            ["dev1", "ca", 57.3, "\"create_time\":\"2021-11-02 20:00:01\"", "2020-02-02 20:00:20"],
                            ["dev1", "ca", 57.3, "\"create_time\":\"2021-11-02 20:00:01\"", "2020-02-02 20:00:23"],
                            ["dev2", "ca", 58.3, "\"create_time\":\"2021-11-02 20:00:10\"", "2020-02-02 20:00:27"]
                        ]}
                ]}
            ],

            "expected_results": [ {"query_id":"601", "expected_results":
                [
                    ["2020-02-02 20:00:18", "2020-02-02 20:00:21", "2020-02-02 20:00:20", "2020-02-02 20:00:20"],
                    ["2020-02-02 20:00:21", "2020-02-02 20:00:24", "2020-02-02 20:00:23", "2020-02-02 20:00:23"]
                ]}
            ]
        },
        {
            "id": 6,
            "tags": ["tumble window"],
            "name": "stream query w/ inputs with timestamp early than latest_stream_only timestamp in stream table",
            "description": "stream query aggregate by max is created and then ingest data w/ timestamp early than latest_stream_only timestamp in stream table, projection based on the inputs should be emitted. ",
            "steps":[
                {"statements": [
                    {"client":"python", "query_id": "601", "query_type": "stream", "query_end_timer": 1,"query":"select id, max(value), window_start, window_end from tumble(test6_stream_only, timestamp, interval 5 second) group by id, window_start, window_end emit stream"}]},
                {"inputs": [
                    {"table_name":"test6_stream_only", "depends_on":"601", "data":[
                        ["dev1", "ca", 57.3, "\"create_time\":\"2021-11-02 20:00:01\"", "2020-02-02 20:00:00"],
                        ["dev2", "ca", 58.3, "\"create_time\":\"2021-11-02 20:00:10\"", "2020-02-02 20:00:03"]
                    ]},

                    {"table_name":"test6_stream_only", "data":[["dev6", "ca", 66, "\"create_time\":\"2021-11-02 20:00:11\"", "2020-02-02 20:00:04"]]}
                    ,
                    {"table_name":"test6_stream_only", "data": [["dev8", "ca", 67, "\"create_time\":\"2021-11-02 20:00:11\"", "2020-02-02 20:00:05"]]},
                    {"table_name":"test6_stream_only", "data":[["dev8", "ca", 67, "\"create_time\":\"2021-11-02 20:00:11\"", "2020-02-02 20:00:30"]]}
                ]}
            ],

            "expected_results": [{"query_id":"601", "expected_results":
                    [["dev2", "58.3", "2020-02-02 20:00:00", "2020-02-02 20:00:05"],
                    ["dev6", "66.0", "2020-02-02 20:00:00", "2020-02-02 20:00:05"],
                    ["dev1", "57.3", "2020-02-02 20:00:00", "2020-02-02 20:00:05"],
                    ["dev8", "67", "2020-02-02 20:00:05", "2020-02-02 20:00:10"]]}]
        },

        {
            "id": 7,
            "tags": ["tumble window", "delay"],
            "name": "stream tumble late events drop w/ window delay interval  - #107",
            "description": "an example positive test_stream_only that uses insert into w/o column",
            "steps": [
                {"statements": [
                    {"client":"python", "query_id":"601" ,"query_type": "stream", "query_end_timer": 1,"query":"select window_start, window_end, count(*) from tumble(test6_stream_only, timestamp, interval 5 second) group by  window_start, window_end, value emit stream after watermark and delay interval 2 second"}]},
                {"inputs": [
                    {"table_name":"test6_stream_only", "depends_on":"601","data": [["dev1", "ca", 57.3, "\"create_time\":\"2021-11-02 20:00:01\"", "2020-02-02 20:00:30"]]},
                    {"table_name":"test6_stream_only", "data": [["dev1", "ca", 57.3, "\"create_time\":\"2021-11-02 20:00:01\"", "2020-02-02 20:00:31"]]},
                    {"table_name":"test6_stream_only", "data": [["dev2", "ca", 57.3, "\"create_time\":\"2021-11-02 20:00:10\"", "2020-02-02 20:00:32"]]},
                    {"table_name":"test6_stream_only", "data": [["dev2", "ca", 59.3, "\"create_time\":\"2021-11-02 20:00:10\"", "2020-02-02 20:00:50"]]},
                    {"table_name":"test6_stream_only", "data": [["dev2", "ca", 58.3, "\"create_time\":\"2021-11-02 20:00:10\"", "2020-02-02 20:00:34"]]},
                    {"table_name":"test6_stream_only", "data": [["dev2", "ca", 58.3, "\"create_time\":\"2021-11-02 20:00:10\"", "2020-02-02 20:00:37"]]},
                    {"table_name":"test6_stream_only", "data": [["dev2", "ca", 58.3, "\"create_time\":\"2021-11-02 20:00:10\"", "2020-02-02 20:00:45"]]}
                ]}
            ]
            ,
            "expected_results": [{"query_id":"601", "expected_results":
                [["2020-02-02 20:00:30", "2020-02-02 20:00:35", 3]]}
            ]
        },
        {
            "id": 8,
            "tags": ["tumble window"],
            "name": "stream tumble w/inputs across multiple windows for window start alignment and the last input in the middle of latest_stream_only window - #101",
            "description": "stream tumble w/inputs across multiple windows for window start alignment and the last input in the middle of latest_stream_only window - #101",
            "steps":[
                {"statements": [
                    {"client":"python", "query_id":"601", "query_type": "stream", "query_end_timer": 1,"query":"select window_start, window_end, count(*) from tumble(test6_stream_only, timestamp, interval 3 second) where value > 50 group by  window_start, window_end emit stream"}]},
                {"inputs": [
                    {"table_name":"test6_stream_only", "depends_on":"601","data": [["dev1", "ca", 57.3, "\"create_time\":\"2021-11-02 20:00:01\"", "2020-02-02 20:00:50"]]},
                    {"table_name":"test6_stream_only", "data": [["dev1", "ca", 57.3, "\"create_time\":\"2021-11-02 20:00:01\"", "2020-02-02 20:00:51"]]},
                    {"table_name":"test6_stream_only", "data": [["dev2", "ca", 58.3, "\"create_time\":\"2021-11-02 20:00:10\"", "2020-02-02 20:00:55"]]},
                    {"table_name":"test6_stream_only", "data": [["dev2", "ca", 58.3, "\"create_time\":\"2021-11-02 20:00:10\"", "2020-02-02 20:00:57"]]}
                ]}
            ],
            "expected_results": [{"query_id":"601", "expected_results":
                [["2020-02-02 20:00:48", "2020-02-02 20:00:51", 1],
                ["2020-02-02 20:00:51", "2020-02-02 20:00:54", 1],
                ["2020-02-02 20:00:54", "2020-02-02 20:00:57", 1]]}
            ]
        },
        {
            "id": 9,
            "tags": ["tumble window", "delay"],
            "name": "stream query tumble window w/delay: no aggregation to be emit before delay gate",
            "description": "steram query with 5sec window and delay 3 sec w/late events within 2 sec delay",
            "steps": [
                {"statements": [
                    {"client":"python", "query_id":"601", "query_type": "stream", "query_end_timer": 1,"query":"select window_start, window_end, count(*) from tumble(test6_stream_only, timestamp, interval 5 second) group by  window_start, window_end, value emit stream after watermark and delay interval 3 second"}]},
                {"inputs": [
                    {"table_name":"test6_stream_only","depends_on":"601", "data": [["dev1", "ca", 57.3, "\"create_time\":\"2021-11-02 20:00:01\"", "2020-02-02 20:01:00"],
                    ["dev1", "ca", 57.3, "\"create_time\":\"2021-11-02 20:00:01\"", "2020-02-02 20:01:01"],
                    ["dev2", "ca", 58.3, "\"create_time\":\"2021-11-02 20:00:10\"", "2020-02-02 20:01:05"]]},
                    {"table_name":"test6_stream_only", "data": [["dev1", "ca", 57.3, "\"create_time\":\"2021-11-02 20:00:01\"", "2020-02-02 20:01:03"],
                    ["dev1", "ca", 57.3, "\"create_time\":\"2021-11-02 20:00:01\"", "2020-02-02 20:01:02"],
                    ["dev2", "ca", 58.3, "\"create_time\":\"2021-11-02 20:00:10\"", "2020-02-02 20:01:07"]]}
                ]}
            ],
            "expected_results": [{"query_id":"601","expected_results":[]}
            ]
        },
        {
            "id":10,
            "tags": ["tumble window", "delay"],
            "name": "stream query tumble window w/delay: no aggregation to be emit when delay gate",
            "description": "steram query with 5sec window and delay 3 sec w/late events within 2 sec delay",
            "steps":[
                {"statements": [
                    {"client":"python", "query_id":"601", "query_type": "stream", "query_end_timer": 1,"query":"select window_start, window_end, count(*) from tumble(test6_stream_only, timestamp, interval 5 second) group by  window_start, window_end, value emit stream after watermark and delay interval 3 second"}]},
                {"inputs": [
                    {"table_name":"test6_stream_only", "depends_on":"601","data": [["dev1", "ca", 57.3, "\"create_time\":\"2021-11-02 20:00:01\"", "2020-02-02 20:01:00"],
                    ["dev1", "ca", 57.3, "\"create_time\":\"2021-11-02 20:00:01\"", "2020-02-02 20:01:01"],
                    ["dev2", "ca", 58.3, "\"create_time\":\"2021-11-02 20:00:10\"", "2020-02-02 20:01:05"]]},
                    {"table_name":"test6_stream_only", "data": [["dev1", "ca", 57.3, "\"create_time\":\"2021-11-02 20:00:01\"", "2020-02-02 20:01:03"],
                    ["dev1", "ca", 57.3, "\"create_time\":\"2021-11-02 20:00:01\"", "2020-02-02 20:01:02"],
                    ["dev2", "ca", 58.3, "\"create_time\":\"2021-11-02 20:00:10\"", "2020-02-02 20:01:08"]]}
                    ]}

            ],

            "expected_results": [{"query_id":"601", "expected_results": [["2020-02-02 20:01:00", "2020-02-02 20:01:05", 4]]}

            ]
        },
        {
            "id": 11,
            "tags": ["hopping window"],
            "name": "stream hopping window max(value) aggregate group by id, window_start, window_end",
            "description": "tumble window aggregate by max and group by id, window_start, window_end",
            "steps": [
                {"statements": [
                    {"client":"python","query_id":"601", "query_type": "stream", "query_end_timer": 1,"query":"select id, max(value), window_start, window_end from hop(test6_stream_only, timestamp, interval 3 second, interval 5 second) group by id, window_start, window_end emit stream"}]},
                {"inputs": [
                    {"table_name":"test6_stream_only","depends_on":"601", "data": [
                        ["dev1", "ca", 57.3, "\"create_time\":\"2021-11-02 20:00:01\"", "2020-02-02 20:00:00"],
                        ["dev2", "ca", 58.3, "\"create_time\":\"2021-11-02 20:00:10\"", "2020-02-02 20:00:03"]
                    ]},

                    {"table_name":"test6_stream_only", "data": [["dev6", "ca", 66, "\"create_time\":\"2021-11-02 20:00:11\"", "2020-02-02 20:00:04"],
                        ["dev6", "ca", 69, "\"create_time\":\"2021-11-02 20:00:11\"", "2020-02-02 20:00:05"]]}
                    ,
                    {"table_name":"test6_stream_only", "data": [["dev8", "ca", 68, "\"create_time\":\"2021-11-02 20:00:11\"", "2020-02-02 20:00:08"],
                        ["dev8", "ca", 67, "\"create_time\":\"2021-11-02 20:00:11\"", "2020-02-02 20:00:10"]
                    ]}
                ]}
            ],
            "expected_results": [{"query_id":"601", "expected_results":[["dev1", "57.3", "2020-02-02 19:59:57", "2020-02-02 20:00:02"],
                ["dev2", "58.3", "2020-02-02 20:00:00", "2020-02-02 20:00:05"],
                ["dev6", "66", "2020-02-02 20:00:00", "2020-02-02 20:00:05"],
                ["dev1", "57.3", "2020-02-02 20:00:00", "2020-02-02 20:00:05"],
                ["dev6", "69", "2020-02-02 20:00:03", "2020-02-02 20:00:08"],
                ["dev2", "58.3", "2020-02-02 20:00:03", "2020-02-02 20:00:08"]]}
                    ]
        },

        {
            "id": 12,
            "tags": ["hopping window", "to verify"],
            "name": "hopping window w/1st data not alinged with window start",
            "description": "tranform function in subquery to extract timestamp from a json and run hopping on the subquery",
            "steps":[
                {"statements": [
                    {"client":"python","query_id":"601", "query_type": "stream", "query_end_timer":5, "query":"select id, max(value), window_start, window_end from hop(test6_stream_only, timestamp, interval 2 second, interval 5 second) group by id, window_start, window_end"}]},
                {"inputs": [
                    {"table_name":"test6_stream_only","depends_on":"601", "data": [["dev1", "ca", 60, "{\"create_time\":\"2021-11-02 20:00:01\"}", "2021-11-02 20:00:01"],
                    ["dev2", "ca", 66, "{\"create_time\":\"2021-11-02 20:00:03\"}", "2021-11-02 20:00:03"],
                    ["dev2", "ca", 58.3, "{\"create_time\":\"2021-11-02 20:00:02\"}", "2021-11-02 20:00:02"]]},
                    {"table_name":"test6_stream_only", "data": [["dev1", "ca", 59, "{\"create_time\":\"2021-11-02 20:00:04\"}", "2021-11-02 20:00:04"],
                    ["dev8", "ca", 67, "{\"create_time\":\"2021-11-02 20:00:05\"}", "2021-11-02 20:00:05"],
                    ["dev8", "ca", 77, "{\"create_time\":\"2021-11-02 20:00:06\"}", "2021-11-02 20:00:06"]]},
                    {"table_name":"test6_stream_only", "data": [["dev3", "ca", 57.3, "{\"create_time\":\"2021-11-02 20:00:09\"}", "2021-11-02 20:00:09"],
                    ["dev3", "ca", 66, "{\"create_time\":\"2021-11-02 20:00:08\"}", "2021-11-02 20:00:08"],
                    ["dev4", "ca", 76, "{\"create_time\":\"2021-11-02 20:00:07\"}", "2021-11-02 20:00:07"]]},
                    {"table_name":"test6_stream_only", "data": [["dev3", "ca", 80, "{\"create_time\":\"2021-11-02 20:00:09\"}", "2021-11-02 20:00:09"],
                    ["dev4", "ca", 67, "{\"create_time\":\"2021-11-02 20:00:01\"}", "2021-11-02 20:00:01"],
                    ["dev9", "ca", 77, "{\"create_time\":\"2021-11-02 20:00:10\"}", "2021-11-02 20:00:10"]]}
                ]}
            ],

            "expected_results": [{"query_id":"601", "expected_results":
                    [["dev1", 60, "2021-11-02 19:59:58", "2021-11-02 20:00:03"],
                    ["dev2", 58.3, "2021-11-02 19:59:58", "2021-11-02 20:00:03"],
                    ["dev2", 66, "2021-11-02 20:00:00", "2021-11-02 20:00:05"],
                    ["dev1", 60, "2021-11-02 20:00:00", "2021-11-02 20:00:05"],
                    ["dev1", 59, "2021-11-02 20:00:02", "2021-11-02 20:00:07"],
                    ["dev2", 66, "2021-11-02 20:00:02", "2021-11-02 20:00:07"],
                    ["dev8", 77, "2021-11-02 20:00:02", "2021-11-02 20:00:07"],
                    ["dev1", 59, "2021-11-02 20:00:04", "2021-11-02 20:00:09"],
                    ["dev8", 77, "2021-11-02 20:00:04", "2021-11-02 20:00:09"],
                    ["dev3", 66, "2021-11-02 20:00:04", "2021-11-02 20:00:09"],
                    ["dev4", 76, "2021-11-02 20:00:04", "2021-11-02 20:00:09"]
                    ]}]
        },

        {
            "id": 13,
            "tags": ["hopping window w/ slide interal > window interval"],
            "name": "stream hopping window max(value) aggregate group by id, window_start, window_end, slide interval > window interval",
            "description": "tumble window aggregate by max and group by id, window_start, window_end",
            "steps":[
                {"statements": [
                    {"client":"python", "query_id":"601", "query_type": "stream","query_end_timer": 1, "query":"select id, max(value), window_start, window_end from hop(test6_stream_only, timestamp, interval 5 second, interval 3 second) group by id, window_start, window_end emit stream"}]},
                {"inputs": [
                    {"table_name":"test6_stream_only","wait":1, "data": [
                        ["dev1", "ca", 57.3, "\"create_time\":\"2021-11-02 20:00:01\"", "2020-02-02 20:00:00"],
                        ["dev2", "ca", 58.3, "\"create_time\":\"2021-11-02 20:00:10\"", "2020-02-02 20:00:03"]
                    ]},

                    {"table_name":"test6_stream_only", "data": [["dev6", "ca", 66, "\"create_time\":\"2021-11-02 20:00:11\"", "2020-02-02 20:00:04"],
                        ["dev6", "ca", 69, "\"create_time\":\"2021-11-02 20:00:11\"", "2020-02-02 20:00:05"]]}
                    ,
                    {"table_name":"test6_stream_only", "data": [["dev8", "ca", 68, "\"create_time\":\"2021-11-02 20:00:11\"", "2020-02-02 20:00:08"],
                        ["dev8", "ca", 67, "\"create_time\":\"2021-11-02 20:00:11\"", "2020-02-02 20:00:10"]
                    ]}
                ]}
            ],
            "expected_results": [{"query_id":"601", "expected_results":"error_code:36"}]
        },
        {
            "id": 14,
            "tags": ["hopping window", "delay"],
            "name": "stream hopping window count(*) w/delay",
            "description": "tumble window aggregate by max and group by id, window_start, window_end",
            "steps":[
                {"statements": [
                    {"client":"python", "query_id":"601", "query_type": "stream","query_end_timer": 1, "query":"select location, count(*), window_start, window_end from hop(test6_stream_only, timestamp, interval 3 second, interval 5 second) group by location, window_start, window_end emit stream after watermark and delay interval 2 second"}]},
                {"inputs": [
                    {"table_name":"test6_stream_only","depends_on":"601", "data": [["dev1", "ca", 51, "\"create_time\":\"2021-11-02 20:00:01\"", "2020-02-02 20:00:00"],
                    ["dev1", "ca", 99, "\"create_time\":\"2021-11-02 20:00:01\"", "2020-02-02 20:00:02"],
                    ["dev1", "ca", 87, "\"create_time\":\"2021-11-02 20:00:01\"", "2020-02-02 20:00:01"],
                    ["dev2", "ca", 66, "\"create_time\":\"2021-11-02 20:00:10\"", "2020-02-02 20:00:03"]]},
                    {"table_name":"test6_stream_only", "data": [["dev2", "ca", 33, "\"create_time\":\"2021-11-02 20:00:10\"", "2020-02-02 20:00:07"]]},
                    {"table_name":"test6_stream_only", "data": [["dev2", "ca", 46, "\"create_time\":\"2021-11-02 20:00:10\"", "2020-02-02 20:00:06"]]},
                    {"table_name":"test6_stream_only", "data": [["dev2", "ca", 98, "\"create_time\":\"2021-11-02 20:00:10\"", "2020-02-02 20:00:05"]]},
                    {"table_name":"test6_stream_only", "data": [["dev2", "ca", 101, "\"create_time\":\"2021-11-02 20:00:10\"", "2020-02-02 20:00:08"]]},
                    {"table_name":"test6_stream_only", "data": [["dev2", "ca", 101, "\"create_time\":\"2021-11-02 20:00:10\"", "2020-02-02 20:00:07"]]},
                    {"table_name":"test6_stream_only", "data": [["dev2", "ca", 56, "\"create_time\":\"2021-11-02 20:00:10\"", "2020-02-02 20:00:10"]]},
                    {"table_name":"test6_stream_only", "data": [["dev1", "ca", 22, "\"create_time\":\"2021-11-02 20:00:01\"", "2020-02-02 20:00:11"],
                    ["dev1", "ca", 51, "\"create_time\":\"2021-11-02 20:00:01\"", "2020-02-02 20:00:14"],
                    ["dev2", "ca", 62, "\"create_time\":\"2021-11-02 20:00:10\"", "2020-02-02 20:00:11"],
                    ["dev2", "ca", 47, "\"create_time\":\"2021-11-02 20:00:10\"", "2020-02-02 20:00:15"]]}
                ]}
            ],
            "expected_results": [{"query_id":"601", "expected_results":
                    [["ca", "2", "2020-02-02 19:59:57", "2020-02-02 20:00:02"],
                    ["ca", "4", "2020-02-02 20:00:00", "2020-02-02 20:00:05"],
                    ["ca", "5", "2020-02-02 20:00:03", "2020-02-02 20:00:08"],
                    ["ca", "5", "2020-02-02 20:00:06", "2020-02-02 20:00:11"]]}]
        },
        {
            "id": 15,
            "tags": ["global aggregation"],
            "name": "global-aggregation-by-max-and-group-by-id-w/by-default-periodic",
            "description": "global aggregation by max and group by id, execute query, end query after 5 second",
            "steps":[
                {"statements": [
                    {"client":"python", "query_id":"601", "query_type": "stream", "query_end_timer":8, "query":"select id, max(value) from test6_stream_only group by id limit 4 emit periodic 5s"}]},
                {"inputs": [
                    {"table_name":"test6_stream_only","depends_on":"601","data": [
                    ["dev1", "ca", 57.3, "\"create_time\":\"2021-11-02 20:00:01\"", "2020-02-02 20:01:00"],
                    ["dev1", "ca", 66, "\"create_time\":\"2021-11-02 20:00:01\"", "2020-02-02 20:01:01"],
                    ["dev2", "ca", 58.3, "\"create_time\":\"2021-11-02 20:00:10\"", "2020-02-02 20:01:05"],
                    ["dev2", "ca", 59, "\"create_time\":\"2021-11-02 20:00:01\"", "2020-02-02 20:01:03"],
                    ["dev8", "ca", 67, "\"create_time\":\"2021-11-02 20:00:01\"", "2020-02-02 20:01:02"],
                    ["dev8", "ca", 77, "\"create_time\":\"2021-11-02 20:00:10\"", "2020-02-02 20:01:08"],
                    ["dev3", "ca", 57.3, "\"create_time\":\"2021-11-02 20:00:01\"", "2020-02-02 20:01:00"],
                    ["dev3", "ca", 66, "\"create_time\":\"2021-11-02 20:00:01\"", "2020-02-02 20:01:01"],
                    ["dev2", "ca", 76, "\"create_time\":\"2021-11-02 20:00:10\"", "2020-02-02 20:01:05"],
                    ["dev2", "ca", 80, "\"create_time\":\"2021-11-02 20:00:01\"", "2020-02-02 20:01:03"],
                    ["dev8", "ca", 67, "\"create_time\":\"2021-11-02 20:00:01\"", "2020-02-02 20:01:02"],
                    ["dev8", "ca", 77, "\"create_time\":\"2021-11-02 20:00:10\"", "2020-02-02 20:01:08"]]}
                ]}
            ],

            "expected_results": [{"query_id":"601", "expected_results":[
                ["dev2", "80"],
                ["dev8", "77"],
                ["dev1", "66"],
                ["dev3", "66"]]}
            ]
        },

        {
            "id": 16,
            "tags": ["global aggregation distinct"],
            "name": "global sum distinct",
            "description": "global aggregation sum distinct and group by id, execute query, end query after 5 second",
            "steps":[
                {"statements": [
                    {"client":"python","query_id":"601", "query_type": "stream", "query_end_timer":8, "query":"select id, sum(distinct value), count(distinct value) from test6_stream_only group by id limit 4 emit periodic 5s"}]},
                {"inputs": [
                    {"table_name":"test6_stream_only", "depends_on":"601","data": [
                    ["dev1", "ca", 57.3, "\"create_time\":\"2021-11-02 20:00:01\"", "2020-02-02 20:01:00"],
                    ["dev1", "ca", 66, "\"create_time\":\"2021-11-02 20:00:01\"", "2020-02-02 20:01:01"],
                    ["dev2", "ca", 58.3, "\"create_time\":\"2021-11-02 20:00:10\"", "2020-02-02 20:01:05"],
                    ["dev2", "ca", 59, "\"create_time\":\"2021-11-02 20:00:01\"", "2020-02-02 20:01:03"],
                    ["dev8", "ca", 67, "\"create_time\":\"2021-11-02 20:00:01\"", "2020-02-02 20:01:02"],
                    ["dev8", "ca", 77, "\"create_time\":\"2021-11-02 20:00:10\"", "2020-02-02 20:01:08"],
                    ["dev3", "ca", 57.3, "\"create_time\":\"2021-11-02 20:00:01\"", "2020-02-02 20:01:00"],
                    ["dev3", "ca", 66, "\"create_time\":\"2021-11-02 20:00:01\"", "2020-02-02 20:01:01"],
                    ["dev2", "ca", 76, "\"create_time\":\"2021-11-02 20:00:10\"", "2020-02-02 20:01:05"],
                    ["dev2", "ca", 80, "\"create_time\":\"2021-11-02 20:00:01\"", "2020-02-02 20:01:03"],
                    ["dev8", "ca", 67, "\"create_time\":\"2021-11-02 20:00:01\"", "2020-02-02 20:01:02"],
                    ["dev8", "ca", 77, "\"create_time\":\"2021-11-02 20:00:10\"", "2020-02-02 20:01:08"]]}
                ]}

            ],

            "expected_results": [{"query_id":"601", "expected_results":
                [["dev2", "273.3", "4"],
                ["dev8", "144", "2"],
                ["dev1", "123.3", "2"],
                ["dev3", "123.3", "2"]]
            }]

        },

        {
            "id": 17,
            "tags": ["last x", "native_not_support"],
            "name": "last x global aggregation w/where",
            "description": "last 5s global aggregation count *",
            "steps":[

                {"inputs": [
                    {"table_name":"test6_stream_only_no_default_tp_time", "wait":3, "data": [["dev1", "ca", 57.3, "\"create_time\":\"2021-11-02 20:00:01\"", "2020-02-02 20:01:00"],
                    ["dev1", "ca", 66, "\"create_time\":\"2021-11-02 20:00:01\"", "2020-02-02 20:01:01"],
                    ["dev2", "ca", 58.3, "\"create_time\":\"2021-11-02 20:00:10\"", "2020-02-02 20:01:05"],
                    ["dev2", "ca", 59, "\"create_time\":\"2021-11-02 20:00:01\"", "2020-02-02 20:01:03"],
                    ["dev8", "ca", 67, "\"create_time\":\"2021-11-02 20:00:01\"", "2020-02-02 20:01:02"],
                    ["dev8", "ca", 77, "\"create_time\":\"2021-11-02 20:00:10\"", "2020-02-02 20:01:08"],
                    ["dev3", "ca", 57.3, "\"create_time\":\"2021-11-02 20:00:01\"", "2020-02-02 20:01:00"],
                    ["dev3", "ca", 66, "\"create_time\":\"2021-11-02 20:00:01\"", "2020-02-02 20:01:01"],
                    ["dev2", "ca", 76, "\"create_time\":\"2021-11-02 20:00:10\"", "2020-02-02 20:01:05"],
                    ["dev2", "ca", 80, "\"create_time\":\"2021-11-02 20:00:01\"", "2020-02-02 20:01:03"],
                    ["dev8", "ca", 67, "\"create_time\":\"2021-11-02 20:00:01\"", "2020-02-02 20:01:02"],
                    ["dev8", "ca", 77, "\"create_time\":\"2021-11-02 20:00:10\"", "2020-02-02 20:01:08"]
                    ]}
                ]},
                {"statements": [
                    {"client":"python","query_id":"601", "wait":1, "query_type": "stream", "query_end_timer":6, "query":"select count(*) from test6_stream_only_no_default_tp_time where value >60 limit 5 emit last 5s"}]}
            ],
            "expected_results": [{"query_id":"601", "expected_results":
                    [["8"],
                    ["8"],
                    ["8"],
                    ["8"],
                    ["8"]
                    ]}]
        },
        {
            "id": 18,
            "tags": ["last x", "native_not_support"],
            "name": "last x tumble delay",
            "description": "max(value) tumble 5s and delay 2s group by id, window_start, window_end and last 1m",
            "steps":[
                {"statements": [
                    {"client":"python","query_id":"601", "query_type": "stream", "query_end_timer":5, "query":"select id, max(value), window_start, window_end from tumble(test6_stream_only_no_default_tp_time, timestamp, 5s) group by id, window_start, window_end limit 6 emit after watermark and delay 2s and last 6s"}]},
                {"inputs": [
                    {"table_name":"test6_stream_only_no_default_tp_time", "depends_on":"601","data": [["dev1", "ca", 57.3, "\"create_time\":\"2021-11-02 20:00:01\"", "2020-02-02 20:01:00"],
                    ["dev1", "ca", 66, "\"create_time\":\"2021-11-02 20:00:01\"", "2020-02-02 20:01:01"],
                    ["dev2", "ca", 58.3, "\"create_time\":\"2021-11-02 20:00:10\"", "2020-02-02 20:01:05"]]},
                    {"table_name":"test6_stream_only_no_default_tp_time", "data": [["dev3", "ca", 59, "\"create_time\":\"2021-11-02 20:00:01\"", "2020-02-02 20:01:03"],
                    ["dev8", "ca", 67, "\"create_time\":\"2021-11-02 20:00:01\"", "2020-02-02 20:01:02"],
                    ["dev8", "ca", 77, "\"create_time\":\"2021-11-02 20:00:10\"", "2020-02-02 20:01:08"]]},
                    {"table_name":"test6_stream_only_no_default_tp_time", "data": [["dev3", "ca", 57.3, "\"create_time\":\"2021-11-02 20:00:01\"", "2020-02-02 20:01:09"],
                    ["dev3", "ca", 66, "\"create_time\":\"2021-11-02 20:00:01\"", "2020-02-02 20:01:10"],
                    ["dev2", "ca", 76, "\"create_time\":\"2021-11-02 20:00:10\"", "2020-02-02 20:01:09"]]},
                    {"table_name":"test6_stream_only_no_default_tp_time", "data": [["dev2", "ca", 80, "\"create_time\":\"2021-11-02 20:00:01\"", "2020-02-02 20:01:07"],
                    ["dev8", "ca", 67, "\"create_time\":\"2021-11-02 20:00:01\"", "2020-02-02 20:01:11"],
                    ["dev8", "ca", 77, "\"create_time\":\"2021-11-02 20:00:10\"", "2020-02-02 20:01:12"]]}
                ]}
            ]
,
            "expected_results": [{"query_id":"601", "expected_results":
                    [["dev1", "66", "2020-02-02 20:01:00", "2020-02-02 20:01:05"],
                    ["dev8", "67", "2020-02-02 20:01:00", "2020-02-02 20:01:05"],
                    ["dev3", "59", "2020-02-02 20:01:00", "2020-02-02 20:01:05"],
                    ["dev8", "77", "2020-02-02 20:01:05", "2020-02-02 20:01:10"],
                    ["dev3", "57.3", "2020-02-02 20:01:05", "2020-02-02 20:01:10"],
                    ["dev2", "80", "2020-02-02 20:01:05", "2020-02-02 20:01:10"]
                    ]}]
        },

        {
            "id": 19,
            "tags": ["last x", "native_not_support"],
            "name": "last x tumble delay with distinct",
            "description": "last 20s tumble 5s count(*)",
            "steps":[
                {"statements": [
                    {"client":"python","query_id":"601", "query_type": "stream", "query_end_timer":8, "query":"select id, sum(distinct value), window_end from tumble(test6_stream_only_no_default_tp_time, timestamp, 5s) group by id, window_end emit after watermark and delay 2s and last 1s"}]},
                {"inputs": [
                    {"table_name":"test6_stream_only_no_default_tp_time","depends_on":"601", "data": [["dev1", "ca", 57.3, "\"create_time\":\"2021-11-02 20:00:01\"", "2020-02-02 20:01:00"],
                    ["dev1", "ca", 57.3, "\"create_time\":\"2021-11-02 20:00:01\"", "2020-02-02 20:01:01"],
                    ["dev2", "ca", 58.3, "\"create_time\":\"2021-11-02 20:00:10\"", "2020-02-02 20:01:05"]]},
                    {"table_name":"test6_stream_only_no_default_tp_time", "data": [["dev3", "ca", 59, "\"create_time\":\"2021-11-02 20:00:01\"", "2020-02-02 20:01:03"],
                    ["dev8", "ca", 67, "\"create_time\":\"2021-11-02 20:00:01\"", "2020-02-02 20:01:02"],
                    ["dev8", "ca", 77, "\"create_time\":\"2021-11-02 20:00:10\"", "2020-02-02 20:01:08"]]},
                    {"table_name":"test6_stream_only_no_default_tp_time", "data": [["dev3", "ca", 57.3, "\"create_time\":\"2021-11-02 20:00:01\"", "2020-02-02 20:01:09"],
                    ["dev3", "ca", 66, "\"create_time\":\"2021-11-02 20:00:01\"", "2020-02-02 20:01:10"],
                    ["dev2", "ca", 76, "\"create_time\":\"2021-11-02 20:00:10\"", "2020-02-02 20:01:09"]]},
                    {"table_name":"test6_stream_only_no_default_tp_time", "data": [["dev2", "ca", 80, "\"create_time\":\"2021-11-02 20:00:01\"", "2020-02-02 20:01:07"],
                    ["dev8", "ca", 67, "\"create_time\":\"2021-11-02 20:00:01\"", "2020-02-02 20:01:11"],
                    ["dev8", "ca", 77, "\"create_time\":\"2021-11-02 20:00:10\"", "2020-02-02 20:01:12"]]}
                ]}
            ],
            "expected_results": [{"query_id":"601", "expected_results":
                    [["dev1", "57.3", "2020-02-02 20:01:05"],
                    ["dev8", "67", "2020-02-02 20:01:05"],
                    ["dev3", "59", "2020-02-02 20:01:05"],
                    ["dev2", "214.3", "2020-02-02 20:01:10"],
                    ["dev8", "77", "2020-02-02 20:01:10"],
                    ["dev3", "57.3", "2020-02-02 20:01:10"]
                    ]}]
        },


        {
            "id": 20,
            "tags": ["tumble window", "timestamp extracted from json"],
            "name": "tumble w/transformed timestamp",
            "description": "extract timestamp from json and run tumble on it",
            "steps":[
                {"statements": [
                    {"client":"python","query_id":"601", "query_type": "stream", "query_end_timer":5, "query":"select id, max(value), window_end from tumble(test6_stream_only, to_datetime(json_extract_string(json, 'create_time')), interval 5 second) group by id, window_end"}]},
                {"inputs": [
                    {"table_name":"test6_stream_only", "depends_on":"601","data": [["dev1", "ca", 60, "{\"create_time\":\"2021-11-02 20:00:01\"}", "2020-02-02 20:01:00"],
                    ["dev2", "ca", 66, "{\"create_time\":\"2021-11-02 20:00:03\"}", "2020-02-02 20:01:01"],
                    ["dev2", "ca", 58.3, "{\"create_time\":\"2021-11-02 20:00:02\"}", "2020-02-02 20:01:03"]]},
                    {"table_name":"test6_stream_only", "data": [["dev1", "ca", 59, "{\"create_time\":\"2021-11-02 20:00:04\"}", "2020-02-02 20:01:06"],
                    ["dev8", "ca", 67, "{\"create_time\":\"2021-11-02 20:00:05\"}", "2020-02-02 20:01:07"],
                    ["dev8", "ca", 77, "{\"create_time\":\"2021-11-02 20:00:06\"}", "2020-02-02 20:01:10"]]},
                    {"table_name":"test6_stream_only", "data": [["dev3", "ca", 57.3, "{\"create_time\":\"2021-11-02 20:00:09\"}", "2020-02-02 20:01:11"],
                    ["dev3", "ca", 66, "{\"create_time\":\"2021-11-02 20:00:08\"}", "2020-02-02 20:01:14"],
                    ["dev4", "ca", 76, "{\"create_time\":\"2021-11-02 20:00:07\"}", "2020-02-02 20:01:11"]]},
                    {"table_name":"test6_stream_only", "data": [["dev3", "ca", 80, "{\"create_time\":\"2021-11-02 20:00:09\"}", "2020-02-02 20:01:13"],
                    ["dev4", "ca", 67, "{\"create_time\":\"2021-11-02 20:00:01\"}", "2020-02-02 20:01:12"],
                    ["dev9", "ca", 77, "{\"create_time\":\"2021-11-02 20:00:10\"}", "2020-02-02 20:01:15"]]}
                ]}
            ],
            "expected_results": [{"query_id":"601", "expected_results":
                    [["dev1", 60, "2021-11-02 20:00:05"],
                    ["dev2", 66, "2021-11-02 20:00:05"],
                    ["dev4", 76, "2021-11-02 20:00:10"],
                    ["dev3", 80, "2021-11-02 20:00:10"],
                    ["dev8", 77, "2021-11-02 20:00:10"]
                    ]}]
        },
        {
            "id": 21,
            "tags": ["hopping window", "timestamp extracted from json"],
            "name": "hop w/transformed timestamp",
            "description": "tranform function in subquery and run tumble on the subquery",
            "steps":[
                {"statements": [
                    {"client":"python","query_id":"601", "query_type": "stream", "query_end_timer":5, "query":"select id, max(value), window_end from hop(test6_stream_only, to_time(json_extract_string(json, 'create_time')), interval 2 second, interval 5 second) where window_end < '2021-11-02 20:00:09' group by id, window_end"}]},
                {"inputs": [
                    {"table_name":"test6_stream_only","depends_on":"601", "data": [["dev1", "ca", 60, "{\"create_time\":\"2021-11-02 20:00:01\"}", "2020-02-02 20:01:00"],
                    ["dev2", "ca", 66, "{\"create_time\":\"2021-11-02 20:00:03\"}", "2020-02-02 20:01:01"],
                    ["dev2", "ca", 58.3, "{\"create_time\":\"2021-11-02 20:00:02\"}", "2020-02-02 20:01:03"]]},
                    {"table_name":"test6_stream_only", "data": [["dev1", "ca", 59, "{\"create_time\":\"2021-11-02 20:00:04\"}", "2020-02-02 20:01:06"],
                    ["dev8", "ca", 67, "{\"create_time\":\"2021-11-02 20:00:05\"}", "2020-02-02 20:01:07"],
                    ["dev8", "ca", 77, "{\"create_time\":\"2021-11-02 20:00:06\"}", "2020-02-02 20:01:10"]]},
                    {"table_name":"test6_stream_only", "data": [["dev3", "ca", 57.3, "{\"create_time\":\"2021-11-02 20:00:09\"}", "2020-02-02 20:01:11"],
                    ["dev3", "ca", 66, "{\"create_time\":\"2021-11-02 20:00:08\"}", "2020-02-02 20:01:14"],
                    ["dev4", "ca", 76, "{\"create_time\":\"2021-11-02 20:00:07\"}", "2020-02-02 20:01:11"]]},
                    {"table_name":"test6_stream_only", "data": [["dev3", "ca", 80, "{\"create_time\":\"2021-11-02 20:00:09\"}", "2020-02-02 20:01:13"],
                    ["dev4", "ca", 67, "{\"create_time\":\"2021-11-02 20:00:01\"}", "2020-02-02 20:01:12"],
                    ["dev9", "ca", 77, "{\"create_time\":\"2021-11-02 20:00:10\"}", "2020-02-02 20:01:15"]]}
                ]}
            ],
            "expected_results": [{"query_id":"601", "expected_results":
                    [["dev2", 58.3, "2021-11-02 20:00:03"],
                    ["dev1", 60, "2021-11-02 20:00:03"],
                    ["dev1", 60, "2021-11-02 20:00:05"],
                    ["dev2", 66, "2021-11-02 20:00:05"],
                    ["dev1", 59, "2021-11-02 20:00:07"],
                    ["dev8", 77, "2021-11-02 20:00:07"],
                    ["dev2", 66, "2021-11-02 20:00:07"]
                    ]}]
        },

        {
            "id": 22,
            "tags": ["join"],
            "name": "stream tail join table",
            "description": "stream tail join table",
            "steps":[
                {"statements": [
                    {"client":"python","query_id":"601", "query_type": "stream", "query_end_timer":1, "query":"select a.id, b.type, a.value from test6_stream_only as a join table(test6_stream_only_d) as b on a.id = b.id"}]},
                {"inputs": [
                    {"table_name":"test6_stream_only", "depends_on":"601","data": [["dev1", "ca", 57.3, "\"create_time\":\"2021-11-02 20:00:01\"", "2020-02-02 20:01:00"],
                    ["dev1", "ca", 66, "\"create_time\":\"2021-11-02 20:00:01\"", "2020-02-02 20:01:01"],
                    ["dev2", "ca", 58.3, "\"create_time\":\"2021-11-02 20:00:10\"", "2020-02-02 20:01:05"]]},
                    {"table_name":"test6_stream_only", "data": [["dev4", "ca", 59, "\"create_time\":\"2021-11-02 20:00:01\"", "2020-02-02 20:01:03"],
                    ["dev8", "ca", 67, "\"create_time\":\"2021-11-02 20:00:01\"", "2020-02-02 20:01:02"],
                    ["dev8", "ca", 77, "\"create_time\":\"2021-11-02 20:00:10\"", "2020-02-02 20:01:08"]]},
                    {"table_name":"test6_stream_only", "data": [["dev3", "ca", 57.3, "\"create_time\":\"2021-11-02 20:00:01\"", "2020-02-02 20:01:00"],
                    ["dev5", "ca", 66, "\"create_time\":\"2021-11-02 20:00:01\"", "2020-02-02 20:01:01"],
                    ["dev2", "ca", 76, "\"create_time\":\"2021-11-02 20:00:10\"", "2020-02-02 20:01:05"]]},
                    {"table_name":"test6_stream_only", "data": [["dev6", "ca", 80, "\"create_time\":\"2021-11-02 20:00:01\"", "2020-02-02 20:01:03"],
                    ["dev8", "ca", 67, "\"create_time\":\"2021-11-02 20:00:01\"", "2020-02-02 20:01:02"],
                    ["dev9", "ca", 77, "\"create_time\":\"2021-11-02 20:00:10\"", "2020-02-02 20:01:08"]]}
                ]}
            ],
            "expected_results": [{"query_id":"601","expected_results":
                    [["dev1", "roof", 57.3],
                    ["dev1", "roof", 66],
                    ["dev2", "field", 58.3],
                    ["dev4", "wall", 59],
                    ["dev8", "floor", 67],
                    ["dev8", "floor", 77],
                    ["dev3", "window", 57.3],
                    ["dev5", "roof", 66],
                    ["dev2", "field",76],
                    ["dev6", "window", 80],
                    ["dev8", "floor", 67]
                    ]}]
        },
        {
            "id": 23,
            "tags": ["join", "bug"],
            "name": "stream table join table w/o aggregation",
            "description": "stream table join table w/o aggregation",
            "steps":[
                {"inputs": [
                    {"table_name":"test6_stream_only", "wait":1, "data": [["dev1", "ca", 57.3, "\"create_time\":\"2021-11-02 20:00:01\"", "2020-02-02 20:01:00"],
                    ["dev1", "ca", 70, "\"create_time\":\"2021-11-02 20:00:01\"", "2020-02-02 20:01:01"],
                    ["dev2", "ca", 58.3, "\"create_time\":\"2021-11-02 20:00:10\"", "2020-02-02 20:01:05"]]}
                ]},
                {"statements": [
                    {"client":"python","query_id":"601", "wait":2, "query_type": "table", "query":"select a.id, b.type, a.value from table(test6_stream_only) as a join table(test6_stream_only_d) as b on a.id = b.id where a.value < 70"}]}
            ],
            "expected_results": [{"query_id":"601", "expected_results":
                    [["dev1", "roof", 57.3],
                    ["dev2", "field", 58.3]
                    ]}]
        },
        {
            "id": 24,
            "tags": ["join", "bug"],
            "name": "stream table join table w/ aggregation",
            "description": "stream table join table w/ aggregation",
            "steps":[
                {"inputs": [
                    {"table_name":"test6_stream_only", "wait":1, "data": [["dev1", "ca", 57.3, "\"create_time\":\"2021-11-02 20:00:01\"", "2020-02-02 20:01:00"],
                    ["dev1", "ca", 66, "\"create_time\":\"2021-11-02 20:00:01\"", "2020-02-02 20:01:01"],
                    ["dev2", "ca", 58.3, "\"create_time\":\"2021-11-02 20:00:10\"", "2020-02-02 20:01:05"]]},
                    {"table_name":"test6_stream_only", "data": [["dev4", "ca", 59, "\"create_time\":\"2021-11-02 20:00:01\"", "2020-02-02 20:01:03"],
                    ["dev8", "ca", 67, "\"create_time\":\"2021-11-02 20:00:01\"", "2020-02-02 20:01:02"],
                    ["dev8", "ca", 77, "\"create_time\":\"2021-11-02 20:00:10\"", "2020-02-02 20:01:08"]]},
                    {"table_name":"test6_stream_only", "data": [["dev3", "ca", 57.3, "\"create_time\":\"2021-11-02 20:00:01\"", "2020-02-02 20:01:00"],
                    ["dev5", "ca", 66, "\"create_time\":\"2021-11-02 20:00:01\"", "2020-02-02 20:01:01"],
                    ["dev2", "ca", 76, "\"create_time\":\"2021-11-02 20:00:10\"", "2020-02-02 20:01:05"]]},
                    {"table_name":"test6_stream_only", "data": [["dev6", "ca", 80, "\"create_time\":\"2021-11-02 20:00:01\"", "2020-02-02 20:01:03"],
                    ["dev8", "ca", 67, "\"create_time\":\"2021-11-02 20:00:01\"", "2020-02-02 20:01:02"],
                    ["dev9", "ca", 77, "\"create_time\":\"2021-11-02 20:00:10\"", "2020-02-02 20:01:08"]]}
                ]},
                { "statements": [
                    {"client":"python","query_id":"601", "wait":5, "query_type": "table", "query":"select a.id, b.type, max(value) from table(test6_stream_only) as a join table(test6_stream_only_d) as b on a.id = b.id group by a.id, b.type"}]}
            ],
            "expected_results": [{"query_id":"601", "expected_results":
                    [["dev1", "roof", 66],
                    ["dev4", "wall", 59],
                    ["dev8", "floor", 77],
                    ["dev3", "window", 57.3],
                    ["dev5", "roof", 66],
                    ["dev2", "field", 76],
                    ["dev6", "window", 80]
                    ]}]
        },
        {
            "id": 25,
            "tags": ["join", "bug"],
            "name": "stream table join table w/ aggregation and where",
            "description": "stream table join table w/ aggregation and where",
            "steps":[
                {"inputs": [
                    {"table_name":"test6_stream_only","wait":1, "data": [["dev1", "ca", 57.3, "\"create_time\":\"2021-11-02 20:00:01\"", "2020-02-02 20:01:00"],
                    ["dev1", "ca", 66, "\"create_time\":\"2021-11-02 20:00:01\"", "2020-02-02 20:01:01"],
                    ["dev2", "ca", 58.3, "\"create_time\":\"2021-11-02 20:00:10\"", "2020-02-02 20:01:05"]]},
                    {"table_name":"test6_stream_only", "data": [["dev4", "ca", 59, "\"create_time\":\"2021-11-02 20:00:01\"", "2020-02-02 20:01:03"],
                    ["dev8", "ca", 67, "\"create_time\":\"2021-11-02 20:00:01\"", "2020-02-02 20:01:02"],
                    ["dev8", "ca", 77, "\"create_time\":\"2021-11-02 20:00:10\"", "2020-02-02 20:01:08"]]},
                    {"table_name":"test6_stream_only", "data": [["dev3", "ca", 57.3, "\"create_time\":\"2021-11-02 20:00:01\"", "2020-02-02 20:01:00"],
                    ["dev5", "ca", 66, "\"create_time\":\"2021-11-02 20:00:01\"", "2020-02-02 20:01:01"],
                    ["dev2", "ca", 76, "\"create_time\":\"2021-11-02 20:00:10\"", "2020-02-02 20:01:05"]]},
                    {"table_name":"test6_stream_only", "data": [["dev6", "ca", 80, "\"create_time\":\"2021-11-02 20:00:01\"", "2020-02-02 20:01:03"],
                    ["dev8", "ca", 67, "\"create_time\":\"2021-11-02 20:00:01\"", "2020-02-02 20:01:02"],
                    ["dev9", "ca", 77, "\"create_time\":\"2021-11-02 20:00:10\"", "2020-02-02 20:01:08"]]}
                ]},
                {"statements": [
                    {"client":"python","query_id":"601", "query_type": "table", "wait":5, "query":"select a.id, b.type, max(value) from table(test6_stream_only) as a join table(test6_stream_only_d) as b on a.id = b.id where b.type = 'field' or b.type = 'roof' group by a.id, b.type"}]}
            ],

            "expected_results": [{"query_id":"601","expected_results":
                    [["dev1", "roof", 66],
                    ["dev5", "roof", 66],
                    ["dev2", "field", 76]
                    ]}]
        },
        {
            "id": 26,
            "tags": ["join"],
            "name": "stream global aggregation join table",
            "description": "global stream aggregation join table",
            "steps":[
                {"statements": [
                    {"client":"python","query_id":"601", "query_type": "stream","query_end_timer":6, "query":"select a.id, b.type, max(value) from test6_stream_only as a join table(test6_stream_only_d) as b on a.id = b.id group by a.id, b.type limit 7 emit periodic 5s"}]},
                {"inputs": [
                    {"table_name":"test6_stream_only", "depends_on":"601","data": [
                    ["dev1", "ca", 57.3, "\"create_time\":\"2021-11-02 20:00:01\"", "2020-02-02 20:01:00"],
                    ["dev1", "ca", 66, "\"create_time\":\"2021-11-02 20:00:01\"", "2020-02-02 20:01:01"],
                    ["dev2", "ca", 58.3, "\"create_time\":\"2021-11-02 20:00:10\"", "2020-02-02 20:01:05"],
                    ["dev4", "ca", 59, "\"create_time\":\"2021-11-02 20:00:01\"", "2020-02-02 20:01:03"],
                    ["dev8", "ca", 67, "\"create_time\":\"2021-11-02 20:00:01\"", "2020-02-02 20:01:02"],
                    ["dev8", "ca", 77, "\"create_time\":\"2021-11-02 20:00:10\"", "2020-02-02 20:01:08"],
                    ["dev3", "ca", 57.3, "\"create_time\":\"2021-11-02 20:00:01\"", "2020-02-02 20:01:00"],
                    ["dev5", "ca", 66, "\"create_time\":\"2021-11-02 20:00:01\"", "2020-02-02 20:01:01"],
                    ["dev2", "ca", 76, "\"create_time\":\"2021-11-02 20:00:10\"", "2020-02-02 20:01:05"],
                    ["dev6", "ca", 80, "\"create_time\":\"2021-11-02 20:00:01\"", "2020-02-02 20:01:03"],
                    ["dev8", "ca", 67, "\"create_time\":\"2021-11-02 20:00:01\"", "2020-02-02 20:01:02"],
                    ["dev9", "ca", 77, "\"create_time\":\"2021-11-02 20:00:10\"", "2020-02-02 20:01:08"]]}
                ]}
            ],
            "expected_results": [{"query_id":"601", "expected_results":
                    [["dev1", "roof", 66],
                    ["dev4", "wall", 59],
                    ["dev8", "floor", 77],
                    ["dev3", "window", 57.3],
                    ["dev5", "roof", 66],
                    ["dev2", "field", 76],
                    ["dev6", "window", 80]
                    ]}]
        },
        {
            "id": 27,
            "tags": ["join"],
            "name": "stream global aggregation join table w/where",
            "description": "global stream aggregation join table w/where",
            "steps":[
                {"statements": [
                    {"client":"python","query_id":"601", "query_type": "stream", "query_end_timer":6, "query":"select a.id, b.type, max(value) from test6_stream_only as a join table(test6_stream_only_d) as b on a.id = b.id where b.type = 'roof' or b.type = 'field' group by a.id, b.type limit 3 emit periodic 5s"}]},
                {"inputs": [
                    {"table_name":"test6_stream_only","depends_on":"601", "data": [["dev1", "ca", 57.3, "\"create_time\":\"2021-11-02 20:00:01\"", "2020-02-02 20:01:00"],
                    ["dev1", "ca", 66, "\"create_time\":\"2021-11-02 20:00:01\"", "2020-02-02 20:01:01"],
                    ["dev2", "ca", 58.3, "\"create_time\":\"2021-11-02 20:00:10\"", "2020-02-02 20:01:05"]]},
                    {"table_name":"test6_stream_only", "data": [["dev4", "ca", 59, "\"create_time\":\"2021-11-02 20:00:01\"", "2020-02-02 20:01:03"],
                    ["dev8", "ca", 67, "\"create_time\":\"2021-11-02 20:00:01\"", "2020-02-02 20:01:02"],
                    ["dev8", "ca", 77, "\"create_time\":\"2021-11-02 20:00:10\"", "2020-02-02 20:01:08"]]},
                    {"table_name":"test6_stream_only", "data": [["dev3", "ca", 57.3, "\"create_time\":\"2021-11-02 20:00:01\"", "2020-02-02 20:01:00"],
                    ["dev5", "ca", 66, "\"create_time\":\"2021-11-02 20:00:01\"", "2020-02-02 20:01:01"],
                    ["dev2", "ca", 76, "\"create_time\":\"2021-11-02 20:00:10\"", "2020-02-02 20:01:05"]]},
                    {"table_name":"test6_stream_only", "data": [["dev6", "ca", 80, "\"create_time\":\"2021-11-02 20:00:01\"", "2020-02-02 20:01:03"],
                    ["dev8", "ca", 67, "\"create_time\":\"2021-11-02 20:00:01\"", "2020-02-02 20:01:02"],
                    ["dev9", "ca", 77, "\"create_time\":\"2021-11-02 20:00:10\"", "2020-02-02 20:01:08"]]}
                ]}
            ],

            "expected_results": [{"query_id":"601", "expected_results":
                    [["dev1", "roof", 66],
                    ["dev5", "roof", 66],
                    ["dev2", "field", 76]
                    ]}]
        }




    ]
}
