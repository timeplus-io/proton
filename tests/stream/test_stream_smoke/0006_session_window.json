{
    "test_suite_name": "session",
    "tag":"smoke",
    "comments":
        "Tests covering session window test cases.",
    "test_suite_config": {
        "table_schemas":[
            {
                "name": "test7_session",
                "type": "table",
                "columns": [
                    {
                        "name": "id",
                        "type": "string"
                    },
                    {
                        "name": "location",
                        "type": "string"
                    },
                    {
                        "name": "value",
                        "type": "float32"
                    },
                    {
                        "name": "json",
                        "type": "string"

                    },
                    {
                        "name": "timestamp",
                        "type": "datetime64(3)",
                        "default": "now64(3)"
                    }
                ],
                "event_time_column":"timestamp"
            }

        ],

        "tests_2_run": {"ids_2_run": ["all"], "tags_2_run":[], "tags_2_skip":{"default":["todo", "to_support", "change", "bug", "sample"],"cluster": ["view", "cluster_table_bug"]}}
    },

    "tests": [
        {
            "id": 0,
            "tags": ["session window"],
            "name": "stream session window with session_size triggered emit",
            "description": "stream session window with session_size triggered emit, 2s interval with session_size 10s",
            "steps":[
                {"statements": [
                    {"client":"python", "query_id": "701", "query_type": "stream", "terminate":"auto", "query_end_timer": 1, "query":"select max(value), to_string(window_start), to_string(window_end), id from session(test7_session, timestamp, 2s) partition by id group by window_start, window_end"}
                ]},
                {"inputs": [
                    {"table_name":"test7_session","depends_on":"701", "wait":1, "data": [
                        ["dev1", "ca", 57.3, "\"create_time\":\"2021-11-02 20:00:00\"", "2020-02-02 20:00:00"],
                        ["dev2", "ca", 58.3, "\"create_time\":\"2021-11-02 20:00:00\"", "2020-02-02 20:00:00"]
                    ]},

                    {"table_name":"test7_session", "data": [["dev1", "ca", 66, "\"create_time\":\"2021-11-02 20:00:02\"", "2020-02-02 20:00:02"]]}
                    ,
                    {"table_name":"test7_session", "data": [["dev1", "ca", 67, "\"create_time\":\"2021-11-02 20:00:11\"", "2020-02-02 20:00:15"]]}
                ]
                }
            ],
            "expected_results": [{"query_id" : "701", "expected_results":
                [
                    [57.3, "2020-02-02 20:00:00.000", "2020-02-02 20:00:02.000", "dev1"],
                    [66, "2020-02-02 20:00:02.000", "2020-02-02 20:00:12.000", "dev1"]
                ]}
            ]
        },

        {
            "id": 1,
            "tags": ["session window"],
            "name": "stream session window with session_size triggered emit",
            "description": "stream session window with session_size triggered emit, 2s interval with session_size 10s",
            "steps":[
                {"statements": [
                    {"client":"python", "query_id": "701", "query_type": "stream", "terminate":"auto", "query_end_timer": 1, "query":"select max(value), to_string(window_start), to_string(window_end), id from session(test7_session, timestamp, 2s) partition by id group by window_start, window_end"}
                ]},
                {"inputs": [
                    {"table_name":"test7_session","depends_on":"701", "wait":1, "data": [
                        ["dev1", "ca", 57.3, "\"create_time\":\"2021-11-02 20:00:00\"", "2020-02-02 20:00:00"],
                        ["dev2", "ca", 58.3, "\"create_time\":\"2021-11-02 20:00:00\"", "2020-02-02 20:00:00"],
                        ["dev1", "ca", 66, "\"create_time\":\"2021-11-02 20:00:02\"", "2020-02-02 20:00:02"],
                        ["dev2", "ca", 67, "\"create_time\":\"2021-11-02 20:00:11\"", "2020-02-02 20:00:15"]
                    ]}
                ]
                }
            ],
            "expected_results": [{"query_id" : "701", "expected_results":
                [
                    ["58.3", "2020-02-02 20:00:00.000", "2020-02-02 20:00:10.000", "dev2"],
                    ["57.3", "2020-02-02 20:00:00.000", "2020-02-02 20:00:02.000", "dev1"]
                ]}
            ]
        },
        
        {
            "id": 2,
            "tags": ["session window"],
            "name": "stream session window with force timeout",
            "description": "stream session window with force timeout, session window interval 1s, input data with 1s interval continuously and session window emit at 5s",
            "steps":[
                {"statements": [
                    {"client":"python", "query_id": "701", "query_type": "stream", "terminate":"auto", "query_end_timer": 1, "query":"select count(), to_string(window_start), to_string(window_end), id from session(test7_session, timestamp, 1s) partition by id group by window_start, window_end"}
                ]},
                {"inputs": [
                    {"table_name":"test7_session", "depends_on":"701", "wait":1, "data": [["dev1", "ca", 57.3, "\"create_time\":\"2021-11-02 20:00:00\"", "2020-02-02 20:00:00"]]},
                    {"table_name":"test7_session", "data": [["dev2", "ca", 58.3, "\"create_time\":\"2021-11-02 20:00:00\"", "2020-02-02 20:00:00"]]},
                    {"table_name":"test7_session", "data": [["dev1", "ca", 57.3, "\"create_time\":\"2021-11-02 20:00:00\"", "2020-02-02 20:00:00.999"]]},
                    {"table_name":"test7_session", "data": [["dev2", "ca", 58.3, "\"create_time\":\"2021-11-02 20:00:00\"", "2020-02-02 20:00:00.999"]]},
                    {"table_name":"test7_session", "data": [["dev1", "ca", 57.3, "\"create_time\":\"2021-11-02 20:00:00\"", "2020-02-02 20:00:01"]]},
                    {"table_name":"test7_session", "data": [["dev2", "ca", 58.3, "\"create_time\":\"2021-11-02 20:00:00\"", "2020-02-02 20:00:01"]]},
                    {"table_name":"test7_session", "data": [["dev1", "ca", 57.3, "\"create_time\":\"2021-11-02 20:00:00\"", "2020-02-02 20:00:01.999"]]},
                    {"table_name":"test7_session", "data": [["dev2", "ca", 58.3, "\"create_time\":\"2021-11-02 20:00:00\"", "2020-02-02 20:00:01.999"]]},
                    {"table_name":"test7_session", "data": [["dev1", "ca", 57.3, "\"create_time\":\"2021-11-02 20:00:00\"", "2020-02-02 20:00:02"]]},
                    {"table_name":"test7_session", "data": [["dev2", "ca", 58.3, "\"create_time\":\"2021-11-02 20:00:00\"", "2020-02-02 20:00:02"]]},
                    {"table_name":"test7_session", "data": [["dev1", "ca", 57.3, "\"create_time\":\"2021-11-02 20:00:00\"", "2020-02-02 20:00:02.999"]]},
                    {"table_name":"test7_session", "data": [["dev2", "ca", 58.3, "\"create_time\":\"2021-11-02 20:00:00\"", "2020-02-02 20:00:02.999"]]},
                    {"table_name":"test7_session", "data": [["dev1", "ca", 57.3, "\"create_time\":\"2021-11-02 20:00:00\"", "2020-02-02 20:00:03"]]},
                    {"table_name":"test7_session", "data": [["dev2", "ca", 58.3, "\"create_time\":\"2021-11-02 20:00:00\"", "2020-02-02 20:00:03"]]},
                    {"table_name":"test7_session", "data": [["dev1", "ca", 57.3, "\"create_time\":\"2021-11-02 20:00:00\"", "2020-02-02 20:00:03.999"]]},
                    {"table_name":"test7_session", "data": [["dev2", "ca", 58.3, "\"create_time\":\"2021-11-02 20:00:00\"", "2020-02-02 20:00:03.999"]]},
                    {"table_name":"test7_session", "data": [["dev1", "ca", 57.3, "\"create_time\":\"2021-11-02 20:00:00\"", "2020-02-02 20:00:04"]]},
                    {"table_name":"test7_session", "data": [["dev2", "ca", 58.3, "\"create_time\":\"2021-11-02 20:00:00\"", "2020-02-02 20:00:04"]]},
                    {"table_name":"test7_session", "data": [["dev1", "ca", 57.3, "\"create_time\":\"2021-11-02 20:00:00\"", "2020-02-02 20:00:04.999"]]},
                    {"table_name":"test7_session", "data": [["dev2", "ca", 58.3, "\"create_time\":\"2021-11-02 20:00:00\"", "2020-02-02 20:00:04.999"]]},
                    {"table_name":"test7_session", "data": [["dev1", "ca", 57.3, "\"create_time\":\"2021-11-02 20:00:00\"", "2020-02-02 20:00:05"]]},
                    {"table_name":"test7_session", "data": [["dev2", "ca", 58.3, "\"create_time\":\"2021-11-02 20:00:00\"", "2020-02-02 20:00:05"]]}
                ]
                }
            ],
            "expected_results": [{"query_id" : "701", "expected_results":
                [
                    ["10", "2020-02-02 20:00:00.000", "2020-02-02 20:00:05.000", "dev2"],
                    ["10", "2020-02-02 20:00:00.000", "2020-02-02 20:00:05.000", "dev1"]
                ]}
            ]
        },                
        {
            "id": 3,
            "tags": ["session window"],
            "name": "multiple stream session window with multiple emits",
            "description": "3 unique stream session window based id and location, session window interval 1s, input data in 2 batches and 1st batch is emit dur to force timeout threshold is it while 2nd is not emit for not hitting threshold",
            "steps":[
                {"statements": [
                    {"client":"python", "query_id": "701", "query_type": "stream", "terminate":"auto", "query_end_timer": 1, "query":"select count(), to_string(window_start), to_string(window_end), id from session(test7_session, timestamp, 2s) partition by id group by window_start, window_end"}
                ]},
                {"inputs": [
                    {"table_name":"test7_session", "depends_on":"701", "wait":1, "data": [["dev1", "ca", 57.3, "\"create_time\":\"2021-11-02 20:00:00\"", "2020-02-02 20:00:00"]]},
                    {"table_name":"test7_session", "data": [["dev2", "ca", 58.3, "\"create_time\":\"2021-11-02 20:00:00\"", "2020-02-02 20:00:00"]]},
                    {"table_name":"test7_session", "data": [["dev3", "ca", 58.3, "\"create_time\":\"2021-11-02 20:00:00\"", "2020-02-02 20:00:00"]]},
                    {"table_name":"test7_session", "data": [["dev1", "ca", 57.3, "\"create_time\":\"2021-11-02 20:00:00\"", "2020-02-02 20:00:01"]]},
                    {"table_name":"test7_session", "data": [["dev2", "ca", 58.3, "\"create_time\":\"2021-11-02 20:00:00\"", "2020-02-02 20:00:01"]]},
                    {"table_name":"test7_session", "data": [["dev3", "ca", 58.3, "\"create_time\":\"2021-11-02 20:00:00\"", "2020-02-02 20:00:01"]]},
                    {"table_name":"test7_session", "data": [["dev4", "ca", 58.3, "\"create_time\":\"2021-11-02 20:00:00\"", "2020-02-02 20:00:05"]]},
                    {"table_name":"test7_session", "data": [["dev1", "ca", 57.3, "\"create_time\":\"2021-11-02 20:00:00\"", "2020-02-02 20:00:06"]]},
                    {"table_name":"test7_session", "data": [["dev2", "ca", 58.3, "\"create_time\":\"2021-11-02 20:00:00\"", "2020-02-02 20:00:06"]]},
                    {"table_name":"test7_session", "data": [["dev3", "ca", 58.3, "\"create_time\":\"2021-11-02 20:00:00\"", "2020-02-02 20:00:06"]]},
                    {"table_name":"test7_session", "data": [["dev1", "ca", 57.3, "\"create_time\":\"2021-11-02 20:00:00\"", "2020-02-02 20:00:07"]]},
                    {"table_name":"test7_session", "data": [["dev2", "ca", 58.3, "\"create_time\":\"2021-11-02 20:00:00\"", "2020-02-02 20:00:07"]]},
                    {"table_name":"test7_session", "data": [["dev3", "ca", 58.3, "\"create_time\":\"2021-11-02 20:00:00\"", "2020-02-02 20:00:07"]]},
                    {"table_name":"test7_session", "data": [["dev4", "ca", 58.3, "\"create_time\":\"2021-11-02 20:00:00\"", "2020-02-02 20:00:11"]]}
                ]
                }
            ],
            "expected_results": [{"query_id" : "701", "expected_results":
                [
                    ["2", "2020-02-02 20:00:00.000", "2020-02-02 20:00:03.000", "dev2"],
                    ["2", "2020-02-02 20:00:00.000", "2020-02-02 20:00:03.000", "dev3"],
                    ["2", "2020-02-02 20:00:00.000", "2020-02-02 20:00:03.000", "dev1"],
                    ["1", "2020-02-02 20:00:05.000", "2020-02-02 20:00:07.000", "dev4"]
                ]}
            ]
        }, 

        {
            "id": 4,
            "tags": ["session window"],
            "name": "multiple stream session window with multiple emits with where clause",
            "description": "3 unique stream session window based id and location, session window interval 1s, input data in 2 batches and triggle 2 batch emits, where clause filter events",
            "steps":[
                {"statements": [
                    {"client":"python", "query_id": "701", "query_type": "stream", "terminate":"auto", "query_end_timer": 3, "query":"select emit_version() as emit_version, count(), to_string(window_start), to_string(window_end), id from session(test7_session, timestamp, 2s) where id !='dev4' partition by id group by window_start, window_end"}
                ]},
                {"inputs": [
                    {"table_name":"test7_session", "depends_on":"701", "wait":1, "data": [["dev1", "ca", 57.3, "\"create_time\":\"2021-11-02 20:00:00\"", "2020-02-02 20:00:00"]]},
                    {"table_name":"test7_session", "data": [["dev2", "ca", 58.3, "\"create_time\":\"2021-11-02 20:00:00\"", "2020-02-02 20:00:00"]]},
                    {"table_name":"test7_session", "data": [["dev3", "ca", 58.3, "\"create_time\":\"2021-11-02 20:00:00\"", "2020-02-02 20:00:00"]]},
                    {"table_name":"test7_session", "data": [["dev1", "ca", 57.3, "\"create_time\":\"2021-11-02 20:00:00\"", "2020-02-02 20:00:01"]]},
                    {"table_name":"test7_session", "data": [["dev2", "ca", 58.3, "\"create_time\":\"2021-11-02 20:00:00\"", "2020-02-02 20:00:01"]]},
                    {"table_name":"test7_session", "data": [["dev3", "ca", 58.3, "\"create_time\":\"2021-11-02 20:00:00\"", "2020-02-02 20:00:01"]]},
                    {"table_name":"test7_session", "data": [["dev4", "ca", 58.3, "\"create_time\":\"2021-11-02 20:00:00\"", "2020-02-02 20:00:05"]]},
                    {"table_name":"test7_session", "data": [["dev2", "ca", 58.3, "\"create_time\":\"2021-11-02 20:00:00\"", "2020-02-02 20:00:02"]]},
                    {"table_name":"test7_session", "data": [["dev3", "ca", 58.3, "\"create_time\":\"2021-11-02 20:00:00\"", "2020-02-02 20:00:02"]]},
                    {"table_name":"test7_session", "data": [["dev2", "ca", 58.3, "\"create_time\":\"2021-11-02 20:00:00\"", "2020-02-02 20:00:04"]]},
                    {"table_name":"test7_session", "data": [["dev3", "ca", 58.3, "\"create_time\":\"2021-11-02 20:00:00\"", "2020-02-02 20:00:04"]]}
                ]
                }
            ],
            "expected_results": [{"query_id" : "701", "expected_results":
                [
                    ["0", "3", "2020-02-02 20:00:00.000", "2020-02-02 20:00:04.000", "dev2"],
                    ["0", "3", "2020-02-02 20:00:00.000", "2020-02-02 20:00:04.000", "dev3"]
                ]}
            ]
        },        

        {
            "id": 5,
            "tags": ["session window"],
            "name": "stream session window with timeout interval triggered emit",
            "description": "stream session window with interval triggered emit, 2s interval with session_size 10s",
            "steps":[
                {"statements": [
                    {"client":"python", "query_id": "701", "query_type": "stream", "terminate":"auto", "query_end_timer": 1, "query":"select max(value), to_string(window_start), to_string(window_end), id from session(test7_session, timestamp, 2s) partition by id group by window_start, window_end"}
                ]},
                {"inputs": [
                    {"table_name":"test7_session","depends_on":"701", "wait":1, "data": [
                        ["dev1", "ca", 57.3, "\"create_time\":\"2021-11-02 20:00:00\"", "2020-02-02 20:00:00"],
                        ["dev2", "ca", 58.3, "\"create_time\":\"2021-11-02 20:00:00\"", "2020-02-02 20:00:01"]
                    ]},

                    {"table_name":"test7_session","data": [
                        ["dev1", "ca", 66, "\"create_time\":\"2021-11-02 20:00:00\"", "2020-02-02 20:00:01"],
                        ["dev2", "ca", 60, "\"create_time\":\"2021-11-02 20:00:00\"", "2020-02-02 20:00:02"]
                    ]},

                    {"table_name":"test7_session", "data": [["dev2", "ca", 67, "\"create_time\":\"2021-11-02 20:00:11\"", "2020-02-02 20:00:05"]]},

                    {"table_name":"test7_session", "data": [["dev1", "ca", 68, "\"create_time\":\"2021-11-02 20:00:11\"", "2020-02-02 20:00:03"]]},

                    {"table_name":"test7_session", "data": [["dev1", "ca", 69, "\"create_time\":\"2021-11-02 20:00:11\"", "2020-02-02 20:00:06"]]}
                ]
                }
            ],
            "expected_results": [{"query_id" : "701", "expected_results":
            [
                ["60", "2020-02-02 20:00:01.000", "2020-02-02 20:00:04.000", "dev2"],
                ["66", "2020-02-02 20:00:00.000", "2020-02-02 20:00:03.000", "dev1"],
                ["68", "2020-02-02 20:00:03.000", "2020-02-02 20:00:05.000", "dev1"]
            ]}
            ]
        },
        {
            "id": 6,
            "tags": ["session window"],
            "name": "stream session window with datetime32",
            "description": "stream session window with interval triggered emit, 5s interval with session_size 25s",
            "steps":[
                {"statements": [
                    {"client":"python", "query_id": "701", "query_type": "stream", "terminate":"auto", "query_end_timer": 1, "query":"select max(value), to_string(window_start), to_string(window_end), id from session(test7_session, to_start_of_interval(timestamp, 2s), 5s) partition by id group by window_start, window_end"}
                ]},
                {"inputs": [
                    {"table_name":"test7_session","depends_on":"701", "wait":1, "data": [
                        ["dev1", "ca", 57.3, "\"create_time\":\"2021-11-02 20:00:00\"", "2020-02-02 20:00:00"],
                        ["dev2", "ca", 58.3, "\"create_time\":\"2021-11-02 20:00:00\"", "2020-02-02 20:00:01"]
                    ]},

                    {"table_name":"test7_session", "data": [
                        ["dev1", "ca", 66, "\"create_time\":\"2021-11-02 20:00:00\"", "2020-02-02 20:00:01"],
                        ["dev2", "ca", 60, "\"create_time\":\"2021-11-02 20:00:00\"", "2020-02-02 20:00:02"]
                    ]},

                    {"table_name":"test7_session", "data": [["dev2", "ca", 67, "\"create_time\":\"2021-11-02 20:00:11\"", "2020-02-02 20:00:08"]]}
                ]
                }
            ],
            "expected_results": [{"query_id" : "701", "expected_results":
            [
                ["60", "2020-02-02 20:00:00", "2020-02-02 20:00:07", "dev2"]
            ]}
            ]
        },
        {
            "id": 7,
            "tags": ["session window"],
            "name": "stream session window with multiple session keys",
            "description": "stream session window with multiple session keys, triggered by interval, 2s interval with session_size 10",
            "steps":[
                {"statements": [
                    {"client":"python", "query_id": "701", "query_type": "stream", "terminate":"auto", "query_end_timer": 1, "query":"select max(value), to_string(window_start), to_string(window_end), id, location from session(test7_session, timestamp, 2s) partition by id, location group by window_start, window_end"}
                ]},
                {"inputs": [
                    {"table_name":"test7_session","depends_on":"701", "wait":1, "data": [
                        ["dev1", "ca", 57.3, "\"create_time\":\"2021-11-02 20:00:00\"", "2020-02-02 20:00:00"],
                        ["dev2", "bj", 58.3, "\"create_time\":\"2021-11-02 20:00:00\"", "2020-02-02 20:00:01"]
                    ]},

                    {"table_name":"test7_session","data": [
                        ["dev1", "ca", 66, "\"create_time\":\"2021-11-02 20:00:00\"", "2020-02-02 20:00:02"],
                        ["dev2", "ca", 60, "\"create_time\":\"2021-11-02 20:00:00\"", "2020-02-02 20:00:02"]
                    ]},

                    {"table_name":"test7_session", "data": [["dev2", "ca", 67, "\"create_time\":\"2021-11-02 20:00:11\"", "2020-02-02 20:00:15"]]}
                ]
                }
            ],
            "expected_results": [{"query_id" : "701", "expected_results":
            [
                ["57.3", "2020-02-02 20:00:00.000", "2020-02-02 20:00:02.000", "dev1", "ca"],
                ["60", "2020-02-02 20:00:02.000", "2020-02-02 20:00:12.000", "dev2", "ca"]
            ]}
            ]
        },
        {
            "id": 8,
            "tags": ["session window", "cluster_table_bug"],
            "name": "stream session window with join",
            "description": "stream session window with multiple session keys, triggered by interval, 2s interval with session_size 10, joins with test7_session_d",
            "steps":[
                {"statements": [
                    {"client":"python", "query_type": "table", "query":"create stream if not exists test7_session_d (id string, type string)"},
                    {"client":"python", "query_type": "table","wait":1, "query":"insert into test7_session_d (id, type) values ('dev1', 'roof') ('dev2', 'field') ('dev3', 'window') ('dev4', 'wall') ('dev5', 'roof') ('dev6', 'window') ('dev7', 'wall') ('dev8', 'floor')"},                    
                    {"client":"python", "query_id": "701", "query_type": "stream","wait":2, "terminate":"auto", "query_end_timer": 3, "query":"select max(value), to_string(window_start), to_string(window_end), id, b.type, location from session(test7_session, timestamp, 2s) as a join table(test7_session_d) as b on a.id = b.id partition by id, location group by window_start, window_end, b.type"}
                ]},
                {"inputs": [
                    {"table_name":"test7_session","depends_on":"701", "wait":1, "data": [
                        ["dev1", "ca", 57.3, "\"create_time\":\"2021-11-02 20:00:00\"", "2020-02-02 20:00:00"],
                        ["dev2", "bj", 58.3, "\"create_time\":\"2021-11-02 20:00:00\"", "2020-02-02 20:00:01"]
                    ]},

                    {"table_name":"test7_session","data": [
                        ["dev1", "ca", 66, "\"create_time\":\"2021-11-02 20:00:00\"", "2020-02-02 20:00:02"],
                        ["dev2", "ca", 60, "\"create_time\":\"2021-11-02 20:00:00\"", "2020-02-02 20:00:02"]
                    ]},

                    {"table_name":"test7_session", "data": [["dev2", "ca", 67, "\"create_time\":\"2021-11-02 20:00:11\"", "2020-02-02 20:00:15"]]}
                ]
                },
                {"statements": [
                    {"client":"python", "wait": 6, "query_type": "table", "query":"drop stream if exists test7_session_d"}
                ]
                }                
            ],
            "expected_results": [{"query_id" : "701", "expected_results":
            [
                ["57.3", "2020-02-02 20:00:00.000", "2020-02-02 20:00:02.000", "dev1", "roof", "ca"],
                ["60", "2020-02-02 20:00:02.000", "2020-02-02 20:00:12.000", "dev2","field", "ca"]
            ]}
            ]
        }  ,
        {
            "id": 9,
            "tags": ["session window"],
            "name": "stream session window on top of sub query tail",
            "description": "stream session window with multiple session keys, triggered by interval, 2s interval with session_size 10, session based on transformed tail",
            "steps":[
                {"statements": [
                    {"client":"python", "query_id": "701", "query_type": "stream", "terminate":"auto", "query_end_timer": 1, "query":"with transformed as (select id, location, value, to_datetime64(json_extract_string(json, 'create_time'), 3, 'UTC') as transformed_timestamp from test7_session) select max(value), to_string(window_start), to_string(window_end), id, location from session(transformed, transformed_timestamp, 2s) partition by id, location group by window_start, window_end"}
                ]},
                {"inputs": [
                    {"table_name":"test7_session","depends_on":"701", "wait":1, "data": [
                        ["dev1", "ca", 57.3, "{\"create_time\":\"2020-02-02 20:00:00\"}", "2020-02-02 20:00:00"],
                        ["dev2", "bj", 58.3, "{\"create_time\":\"2020-02-02 20:00:01\"}", "2020-02-02 20:00:01"]
                    ]},

                    {"table_name":"test7_session","data": [
                        ["dev1", "ca", 66, "{\"create_time\":\"2020-02-02 20:00:02\"}", "2020-02-02 20:00:02"],
                        ["dev2", "ca", 60, "{\"create_time\":\"2020-02-02 20:00:02\"}", "2020-02-02 20:00:02"]
                    ]},

                    {"table_name":"test7_session", "data": [["dev2", "ca", 67, "{\"create_time\":\"2020-02-02 20:00:15\"}", "2020-02-02 20:00:15"]]}
                ]
                }
            ],
            "expected_results": [{"query_id" : "701", "expected_results":
            [
                ["57.3", "2020-02-02 20:00:00.000", "2020-02-02 20:00:02.000", "dev1", "ca"],
                ["60", "2020-02-02 20:00:02.000", "2020-02-02 20:00:12.000", "dev2", "ca"]
            ]}
            ]
        },
        {
            "id": 10,
            "tags": ["session window", "cluster_table_bug"],
            "name": "stream session window as sub query",
            "description": "stream session window with multiple session keys, triggered by interval, 2s interval with session_size 10, session as subquery",
            "steps":[
                {"statements": [
                    {"client":"python", "query_type": "table", "query":"drop stream if exists test7_session_d"},
                    {"client":"python", "query_type": "table", "wait":1, "query":"create stream if not exists test7_session_d (id string, type string)"},
                    {"client":"python", "query_type": "table","wait":1, "query":"insert into test7_session_d (id, type) values ('dev1', 'roof') ('dev2', 'field') ('dev3', 'window') ('dev4', 'wall') ('dev5', 'roof') ('dev6', 'window') ('dev7', 'wall') ('dev8', 'floor')"},                    
                    {"client":"python", "query_id": "702", "wait":4, "query_type": "stream", "terminate":"auto", "query_end_timer": 3, "query":"with transformed as (select max(value) over(partition by id, location), to_string(window_start) as s, to_string(window_end) as e, id, b.type, location from session(test7_session, timestamp, 2s) as a join table(test7_session_d) as b on a.id = b.id group by window_start, window_end, id, location, b.type) select * from transformed"}
                ]},
                {"inputs": [
                    {"table_name":"test7_session","depends_on_stream": "test7_session_d","depends_on":"702", "wait":1, "data": [
                        ["dev1", "ca", 57.3, "{\"create_time\":\"2020-02-02 20:00:00+00:00\"}", "2020-02-02 20:00:00"],
                        ["dev2", "bj", 58.3, "{\"create_time\":\"2020-02-02 20:00:01+00:00\"}", "2020-02-02 20:00:01"]
                    ]},

                    {"table_name":"test7_session","data": [
                        ["dev1", "ca", 66, "{\"create_time\":\"2020-02-02 20:00:02+00:00\"}", "2020-02-02 20:00:02"],
                        ["dev2", "ca", 60, "{\"create_time\":\"2020-02-02 20:00:02+00:00\"}", "2020-02-02 20:00:02"]
                    ]},

                    {"table_name":"test7_session", "data": [["dev2", "ca", 67, "{\"create_time\":\"2020-02-02 20:00:15+00:00\"}", "2020-02-02 20:00:15"]]}
                ]
                }     
            ],
            "expected_results": [{"query_id" : "702", "expected_results":
            [
                ["57.3", "2020-02-02 20:00:00.000", "2020-02-02 20:00:02.000", "dev1", "roof", "ca"],
                ["60", "2020-02-02 20:00:02.000", "2020-02-02 20:00:12.000", "dev2","field", "ca"]
            ]}
            ]
        },         
        {
            "id": 11,
            "tags": ["session window"],
            "name": "stream session window on top of tumble sub query",
            "description": "stream session window with multiple session keys, triggered by interval, 2s interval with session_size 10, session based on tumble",
            "steps":[
                {"statements": [
                    {"client":"python", "query_id": "701", "query_type": "stream", "terminate":"auto", "query_end_timer": 1, "query":"with transformed as (select id, location, max(value) as max_v, window_start as w_s, window_end as w_e from tumble(test7_session, to_datetime64(json_extract_string(json, 'create_time'), 3), 2s) group by id, location, window_start, window_end) select count(max_v), to_string(window_start), to_string(window_end), id, location from session(transformed, w_e, 2001ms) partition by id, location group by window_start, window_end"}
                ]},
                {"inputs": [
                    {"table_name":"test7_session","depends_on":"701", "wait":1, "data": [
                        ["dev1", "ca", 57.3, "{\"create_time\":\"2020-02-02 20:00:00\"}", "2020-02-02 20:00:00"],
                        ["dev2", "bj", 58.3, "{\"create_time\":\"2020-02-02 20:00:01\"}", "2020-02-02 20:00:01"],
                        ["dev2", "bj", 58.3, "{\"create_time\":\"2020-02-02 20:00:02\"}", "2020-02-02 20:00:02"]
                    ]},

                    {"table_name":"test7_session","depends_on":"701", "data": [
                        ["dev1", "ca", 66, "{\"create_time\":\"2020-02-02 20:00:03\"}", "2020-02-02 20:00:03"],
                        ["dev2", "ca", 60, "{\"create_time\":\"2020-02-02 20:00:04\"}", "2020-02-02 20:00:04"]
                    ]},

                    {"table_name":"test7_session", "data": [
                        ["dev1", "ca", 67, "{\"create_time\":\"2020-02-02 20:00:15\"}", "2020-02-02 20:00:15"],
                        ["dev2", "ca", 67, "{\"create_time\":\"2020-02-02 20:00:16\"}", "2020-02-02 20:00:16"],
                        ["dev3", "ca", 67, "{\"create_time\":\"2020-02-02 20:00:20\"}", "2020-02-02 20:00:20"]
                    
                    ]}
                ]
                }
            ],
            "expected_results": [{"query_id" : "701", "expected_results":
            [
                ["2", "2020-02-02 20:00:02.000", "2020-02-02 20:00:12.005", "dev1", "ca"],
                ["1", "2020-02-02 20:00:06.000", "2020-02-02 20:00:16.005", "dev2", "ca"]
            ]}
            ]
        }, 
        {
            "id": 12,
            "tags": ["session window"],
            "name": "stream session window on top of hopping sub query",
            "description": "stream session window with multiple session keys, triggered by interval, 2s interval with session_size 10, session based on hop",
            "steps":[
                {"statements": [
                    {"client":"python", "query_id": "701", "query_type": "stream", "terminate":"auto", "query_end_timer": 1, "query":"with transformed as (select id, location, value, to_datetime64(json_extract_string(json, 'create_time'), 3, 'UTC') as transformed_timestamp from test7_session) select max(value), window_start, window_end, id, location from session(transformed, transformed_timestamp, 2s) partition by id, location group by window_start, window_end"}
                ]},
                {"inputs": [
                    {"table_name":"test7_session","depends_on":"701", "wait":1, "data": [
                        ["dev1", "ca", 57.3, "{\"create_time\":\"2020-02-02 20:00:00.000\"}", "2020-02-02 20:00:00+00:00"],
                        ["dev2", "bj", 58.3, "{\"create_time\":\"2020-02-02 20:00:01.000\"}", "2020-02-02 20:00:01+00:00"]
                    ]},

                    {"table_name":"test7_session","depends_on":"701", "data": [
                        ["dev1", "ca", 66, "{\"create_time\":\"2020-02-02 20:00:02\"}", "2020-02-02 20:00:02+00:00"],
                        ["dev2", "ca", 60, "{\"create_time\":\"2020-02-02 20:00:02\"}", "2020-02-02 20:00:02+00:00"]
                    ]},

                    {"table_name":"test7_session", "data": [["dev2", "ca", 67, "{\"create_time\":\"2020-02-02 20:00:15\"}", "2020-02-02 20:00:15+00:00"]]}
                ]
                }
            ],
            "expected_results": [{"query_id" : "701", "expected_results":
            [
                ["57.3", "2020-02-02 20:00:00+00:00", "2020-02-02 20:00:02+00:00", "dev1", "ca"],
                ["60", "2020-02-02 20:00:02+00:00", "2020-02-02 20:00:12+00:00", "dev2", "ca"]
            ]}
            ]
        },
        {
            "id": 13,
            "tags": ["session window"],
            "name": "tumble window on top of session window sub query",
            "description": "stream session window with multiple session keys, triggered by interval, 2s interval with session_size 10, tumble based on session",
            "steps":[
                {"statements": [
                    {"client":"python", "query_id": "701", "query_type": "stream", "terminate":"auto", "query_end_timer": 1, "query":"with transformed as (select id, location, value, to_datetime64(json_extract_string(json, 'create_time'), 3, 'UTC') as transformed_timestamp from test7_session) select max(value), window_start, window_end, id, location from session(transformed, transformed_timestamp, 2s) partition by id, location group by window_start, window_end"}
                ]},
                {"inputs": [
                    {"table_name":"test7_session","depends_on":"701", "wait":1, "data": [
                        ["dev1", "ca", 57.3, "{\"create_time\":\"2020-02-02 20:00:00\"}", "2020-02-02 20:00:00+00:00"],
                        ["dev2", "bj", 58.3, "{\"create_time\":\"2020-02-02 20:00:01\"}", "2020-02-02 20:00:01+00:00"]
                    ]},

                    {"table_name":"test7_session","depends_on":"701", "data": [
                        ["dev1", "ca", 66, "{\"create_time\":\"2020-02-02 20:00:02\"}", "2020-02-02 20:00:02+00:00"],
                        ["dev2", "ca", 60, "{\"create_time\":\"2020-02-02 20:00:02\"}", "2020-02-02 20:00:02+00:00"]
                    ]},

                    {"table_name":"test7_session", "data": [["dev2", "ca", 67, "{\"create_time\":\"2020-02-02 20:00:15\"}", "2020-02-02 20:00:15+00:00"]]}
                ]
                }
            ],
            "expected_results": [{"query_id" : "701", "expected_results":
            [
                ["57.3", "2020-02-02 20:00:00+00:00", "2020-02-02 20:00:02+00:00", "dev1", "ca"],
                ["60", "2020-02-02 20:00:02+00:00", "2020-02-02 20:00:12+00:00", "dev2", "ca"]
            ]}
            ]
        },
        {
            "id": 14,
            "tags": ["session window"],
            "name": "timestamp in datetime64",
            "description": "insert event with tp_time in milliseconds",
            "steps":[
                {"statements": [
                    {"client":"python", "query_id": "701", "query_type": "stream", "terminate":"auto", "query_end_timer": 1, "query":"select max(value), to_string(window_start), to_string(window_end), id from session(test7_session, timestamp, 5s) partition by id group by window_start, window_end"}
                ]},
                {"inputs": [
                    {"table_name":"test7_session","depends_on":"701", "wait":1, "data": [
                        ["dev1", "ca", 57.3, "\"create_time\":\"2021-11-02 20:00:00\"", "2020-02-02 20:00:00.262"],
                        ["dev1", "ca", 58.3, "\"create_time\":\"2021-11-02 20:00:00\"", "2020-02-02 20:00:05.261"],
                        ["dev1", "ca", 66, "\"create_time\":\"2021-11-02 20:00:02\"", "2020-02-02 20:00:10.263"],
                        ["dev1", "ca", 67, "\"create_time\":\"2021-11-02 20:00:11\"", "2020-02-02 20:00:20"]
                    ]}
                ]
                }
            ],
            "expected_results": [{"query_id" : "701", "expected_results":
                [
                    ["58.3", "2020-02-02 20:00:00.262", "2020-02-02 20:00:10.261", "dev1"],
                    ["66", "2020-02-02 20:00:10.263", "2020-02-02 20:00:15.263","dev1"]
                ]}
            ]
        },
        {
            "id": 15,
            "tags": ["session window"],
            "name": "max emit timeout",
            "description": "insert event with tp_time in milliseconds",
            "steps":[
                {"statements": [
                    {"client":"python", "query_id": "701", "query_type": "stream", "terminate":"auto", "query_end_timer": 1, "query":"select max(value), to_string(window_start), to_string(window_end), id from session(test7_session, timestamp, 5s, 10s) partition by id group by window_start, window_end"}
                ]},
                {"inputs": [
                    {"table_name":"test7_session","depends_on":"701", "wait":1, "data": [
                        ["dev1", "ca", 57.3, "\"create_time\":\"2021-11-02 20:00:00\"", "2020-02-02 20:00:00.262"],
                        ["dev1", "ca", 58.3, "\"create_time\":\"2021-11-02 20:00:00\"", "2020-02-02 20:00:05.261"],
                        ["dev1", "ca", 59.3, "\"create_time\":\"2021-11-02 20:00:00\"", "2020-02-02 20:00:08.262"],
                        ["dev1", "ca", 66, "\"create_time\":\"2021-11-02 20:00:04\"", "2020-02-02 20:00:10.263"],
                        ["dev1", "ca", 67, "\"create_time\":\"2021-11-02 20:00:00\"", "2020-02-02 20:00:13.262"],
                        ["dev1", "ca", 68, "\"create_time\":\"2021-11-02 20:00:00\"", "2020-02-02 20:00:16.262"],
                        ["dev1", "ca", 69, "\"create_time\":\"2021-11-02 20:00:11\"", "2020-02-02 20:00:21.262"]
                    ]}
                ]
                }
            ],
            "expected_results": [{"query_id" : "701", "expected_results":
                [
                    ["59.3", "2020-02-02 20:00:00.262", "2020-02-02 20:00:10.262", "dev1"],
                    ["68", "2020-02-02 20:00:10.263", "2020-02-02 20:00:20.263","dev1"]
                ]}
            ]
        },
        {
            "id": 16,
            "tags": ["session window"],
            "name": "start/end predictions",
            "description": "insert event with tp_time in milliseconds",
            "steps":[
                {"statements": [
                    {"client":"python", "query_id": "701", "query_type": "stream", "terminate":"auto", "query_end_timer": 1, "query":"select max(value), to_string(window_start), to_string(window_end), id from session(test7_session, timestamp, 5s, location='ca', location<>'ca') partition by id group by window_start, window_end"}
                ]},
                {"inputs": [
                    {"table_name":"test7_session","depends_on":"701", "wait":1, "data": [
                        ["dev1", "sh", 60.3, "\"create_time\":\"2021-11-02 20:00:00\"", "2020-02-02 19:59:55.262"],
                        ["dev1", "ca", 57.3, "\"create_time\":\"2021-11-02 20:00:00\"", "2020-02-02 20:00:00.261"],
                        ["dev1", "ca", 58.3, "\"create_time\":\"2021-11-02 20:00:00\"", "2020-02-02 20:00:05.260"],
                        ["dev1", "sh", 59.3, "\"create_time\":\"2021-11-02 20:00:00\"", "2020-02-02 20:00:08.262"],
                        ["dev1", "ca", 66, "\"create_time\":\"2021-11-02 20:00:04\"", "2020-02-02 20:00:10.263"],
                        ["dev1", "ca", 67, "\"create_time\":\"2021-11-02 20:00:00\"", "2020-02-02 20:00:13.262"],
                        ["dev1", "ca", 68, "\"create_time\":\"2021-11-02 20:00:00\"", "2020-02-02 20:00:16.262"],
                        ["dev1", "sh", 69, "\"create_time\":\"2021-11-02 20:00:11\"", "2020-02-02 20:00:21.261"]
                    ]}
                ]
                }
            ],
            "expected_results": [{"query_id" : "701", "expected_results":
                [
                    ["59.3", "2020-02-02 20:00:00.261", "2020-02-02 20:00:08.263", "dev1"],
                    ["69", "2020-02-02 20:00:10.263", "2020-02-02 20:00:21.262","dev1"]
                ]}
            ]
        },
        {
            "id": 17,
            "tags": ["session window"],
            "name": "start/end predictions",
            "description": "insert event with tp_time in milliseconds",
            "steps":[
                {"statements": [
                    {"client":"python", "query_id": "701", "query_type": "stream", "terminate":"auto", "query_end_timer": 1, "query":"select min(value), max(value), count(location), to_string(window_start), to_string(window_end), id from session(test7_session, 5s, [location='ca', location='sh']) partition by id group by window_start, window_end"}
                ]},
                {"inputs": [
                    {"table_name":"test7_session","depends_on":"701", "wait":1, "data": [
                        ["dev1", "sh", 60.3, "\"create_time\":\"2021-11-02 20:00:00\"", "2020-02-02 19:59:55.262+00:00"],
                        ["dev1", "ca", 57.3, "\"create_time\":\"2021-11-02 20:00:00\"", "2020-02-02 20:00:00.261+00:00"],
                        ["dev1", "ca", 58.3, "\"create_time\":\"2021-11-02 20:00:00\"", "2020-02-02 20:00:05.260+00:00"],
                        ["dev1", "sh", 59.3, "\"create_time\":\"2021-11-02 20:00:00\"", "2020-02-02 20:00:08.262+00:00"],
                        ["dev1", "ca", 66, "\"create_time\":\"2021-11-02 20:00:04\"", "2020-02-02 20:00:10.263+00:00"],
                        ["dev1", "da", 67, "\"create_time\":\"2021-11-02 20:00:00\"", "2020-02-02 20:00:13.262+00:00"],
                        ["dev1", "ca", 68, "\"create_time\":\"2021-11-02 20:00:00\"", "2020-02-02 20:00:16.262+00:00"],
                        ["dev1", "sh", 69, "\"create_time\":\"2021-11-02 20:00:11\"", "2020-02-02 20:00:18.261+00:00"]
                    ]}
                ]
                }
            ],
            "expected_results": [{"query_id" : "701", "expected_results":
                [
                    ["57.3", "59.3", "3", "2020-02-02 20:00:00.261", "2020-02-02 20:00:08.263", "dev1"],
                    ["66", "69", "4", "2020-02-02 20:00:10.263", "2020-02-02 20:00:18.262", "dev1"]
                ]}
            ]
        },
        {
            "id": 18,
            "tags": ["session window"],
            "name": "start/end predictions",
            "description": "insert event with tp_time in milliseconds",
            "steps":[
                {"statements": [
                    {"client":"python", "query_id": "701", "query_type": "stream", "terminate":"auto", "query_end_timer": 1, "query":"select min(value), max(value), count(location), to_string(window_start), to_string(window_end), id from session(test7_session, 5s, [location='ca', location='sh')) partition by id group by window_start, window_end"}
                ]},
                {"inputs": [
                    {"table_name":"test7_session","depends_on":"701", "wait":1, "data": [
                        ["dev1", "sh", 60.3, "\"create_time\":\"2021-11-02 20:00:00\"", "2020-02-02 19:59:55.262+00:00"],
                        ["dev1", "ca", 57.3, "\"create_time\":\"2021-11-02 20:00:00\"", "2020-02-02 20:00:00.261+00:00"],
                        ["dev1", "ca", 58.3, "\"create_time\":\"2021-11-02 20:00:00\"", "2020-02-02 20:00:05.260+00:00"],
                        ["dev1", "sh", 59.3, "\"create_time\":\"2021-11-02 20:00:00\"", "2020-02-02 20:00:08.262+00:00"],
                        ["dev1", "ca", 66, "\"create_time\":\"2021-11-02 20:00:04\"", "2020-02-02 20:00:10.263+00:00"],
                        ["dev1", "da", 67, "\"create_time\":\"2021-11-02 20:00:00\"", "2020-02-02 20:00:13.262+00:00"],
                        ["dev1", "ca", 68, "\"create_time\":\"2021-11-02 20:00:00\"", "2020-02-02 20:00:16.262+00:00"],
                        ["dev1", "sh", 69, "\"create_time\":\"2021-11-02 20:00:11\"", "2020-02-02 20:00:18.262+00:00"]
                    ]}
                ]
                }
            ],
            "expected_results": [{"query_id" : "701", "expected_results":
                [
                    ["57.3", "58.3", "2", "2020-02-02 20:00:00.261", "2020-02-02 20:00:08.262", "dev1"],
                    ["66", "68", "3", "2020-02-02 20:00:10.263", "2020-02-02 20:00:18.262", "dev1"]
                ]}
            ]
        },
        {
            "id": 19,
            "tags": ["session window"],
            "name": "start/end predictions",
            "description": "insert event with tp_time in milliseconds",
            "steps":[
                {"statements": [
                    {"client":"python", "query_id": "701", "query_type": "stream", "terminate":"auto", "query_end_timer": 1, "query":"select min(value), max(value), count(location), to_string(window_start), to_string(window_end), id from session(test7_session, 5s, (location='ca', location='sh']) partition by id group by window_start, window_end"}
                ]},
                {"inputs": [
                    {"table_name":"test7_session","depends_on":"701", "wait":1, "data": [
                        ["dev1", "sh", 60.3, "\"create_time\":\"2021-11-02 20:00:00\"", "2020-02-02 19:59:55.262+00:00"],
                        ["dev1", "ca", 57.3, "\"create_time\":\"2021-11-02 20:00:00\"", "2020-02-02 20:00:00.261+00:00"],
                        ["dev1", "ca", 58.3, "\"create_time\":\"2021-11-02 20:00:00\"", "2020-02-02 20:00:05.260+00:00"],
                        ["dev1", "sh", 59.3, "\"create_time\":\"2021-11-02 20:00:00\"", "2020-02-02 20:00:08.262+00:00"],
                        ["dev1", "ca", 66, "\"create_time\":\"2021-11-02 20:00:04\"", "2020-02-02 20:00:10.263+00:00"],
                        ["dev1", "da", 67, "\"create_time\":\"2021-11-02 20:00:00\"", "2020-02-02 20:00:13.262+00:00"],
                        ["dev1", "ca", 68, "\"create_time\":\"2021-11-02 20:00:00\"", "2020-02-02 20:00:16.262+00:00"],
                        ["dev1", "sh", 69, "\"create_time\":\"2021-11-02 20:00:11\"", "2020-02-02 20:00:18.262+00:00"]
                    ]}
                ]
                }
            ],
            "expected_results": [{"query_id" : "701", "expected_results":
                [
                    ["58.3", "59.3", "2", "2020-02-02 20:00:05.260", "2020-02-02 20:00:08.263", "dev1"],
                    ["67", "69", "3", "2020-02-02 20:00:13.262", "2020-02-02 20:00:18.263", "dev1"]
                ]}
            ]
        },
        {
            "id": 20,
            "tags": ["session window"],
            "name": "start/end predictions",
            "description": "insert event with tp_time in milliseconds",
            "steps":[
                {"statements": [
                    {"client":"python", "query_id": "701", "query_type": "stream", "terminate":"auto", "query_end_timer": 1, "query":"select min(value), max(value), count(location), to_string(window_start), to_string(window_end), id from session(test7_session, 5s, (location='ca', location='sh')) partition by id group by window_start, window_end"}
                ]},
                {"inputs": [
                    {"table_name":"test7_session","depends_on":"701", "wait":1, "data": [
                        ["dev1", "sh", 60.3, "\"create_time\":\"2021-11-02 20:00:00\"", "2020-02-02 19:59:55.262+00:00"],
                        ["dev1", "ca", 57.3, "\"create_time\":\"2021-11-02 20:00:00\"", "2020-02-02 20:00:00.261+00:00"],
                        ["dev1", "ca", 58.3, "\"create_time\":\"2021-11-02 20:00:00\"", "2020-02-02 20:00:05.260+00:00"],
                        ["dev1", "sh", 59.3, "\"create_time\":\"2021-11-02 20:00:00\"", "2020-02-02 20:00:08.262+00:00"],
                        ["dev1", "ca", 66, "\"create_time\":\"2021-11-02 20:00:04\"", "2020-02-02 20:00:10.263+00:00"],
                        ["dev1", "da", 67, "\"create_time\":\"2021-11-02 20:00:00\"", "2020-02-02 20:00:13.262+00:00"],
                        ["dev1", "ca", 68, "\"create_time\":\"2021-11-02 20:00:00\"", "2020-02-02 20:00:16.262+00:00"],
                        ["dev1", "sh", 69, "\"create_time\":\"2021-11-02 20:00:11\"", "2020-02-02 20:00:18.262+00:00"]
                    ]}
                ]
                }
            ],
            "expected_results": [{"query_id" : "701", "expected_results":
                [
                    ["58.3", "58.3", "1", "2020-02-02 20:00:05.260", "2020-02-02 20:00:08.262", "dev1"],
                    ["67", "68", "2", "2020-02-02 20:00:13.262", "2020-02-02 20:00:18.262", "dev1"]
                ]}
            ]
        },
        {
            "id": 21,
            "tags": ["session window"],
            "name": "start/end predictions",
            "description": "insert event with tp_time in milliseconds",
            "steps":[
                {"statements": [
                    {"client":"python", "query_id": "701", "query_type": "stream", "terminate":"auto", "query_end_timer": 1, "query":"select to_string(window_start), to_string(window_end), date_diff('second', window_start, window_end) from session(test7_session, 5s, [location='ca', location='sh')) group by window_start, window_end"}
                ]},
                {"inputs": [
                    {"table_name":"test7_session","depends_on":"701", "wait":1, "data": [
                        ["dev1", "sh", 60.3, "\"create_time\":\"2021-11-02 20:00:00\"", "2020-02-02 19:59:55.262+00:00"],
                        ["dev1", "ca", 57.3, "\"create_time\":\"2021-11-02 20:00:00\"", "2020-02-02 20:00:00.261+00:00"],
                        ["dev1", "ca", 58.3, "\"create_time\":\"2021-11-02 20:00:00\"", "2020-02-02 20:00:05.260+00:00"],
                        ["dev1", "sh", 59.3, "\"create_time\":\"2021-11-02 20:00:00\"", "2020-02-02 20:00:08.262+00:00"],
                        ["dev1", "ca", 66, "\"create_time\":\"2021-11-02 20:00:04\"", "2020-02-02 20:00:10.263+00:00"],
                        ["dev1", "da", 67, "\"create_time\":\"2021-11-02 20:00:00\"", "2020-02-02 20:00:13.262+00:00"],
                        ["dev1", "ca", 68, "\"create_time\":\"2021-11-02 20:00:00\"", "2020-02-02 20:00:16.262+00:00"],
                        ["dev1", "sh", 69, "\"create_time\":\"2021-11-02 20:00:11\"", "2020-02-02 20:00:18.262+00:00"]
                    ]}
                ]
                }
            ],
            "expected_results": [{"query_id" : "701", "expected_results":
                [
                    ["2020-02-02 20:00:00.261", "2020-02-02 20:00:08.262", 8],
                    ["2020-02-02 20:00:10.263", "2020-02-02 20:00:18.262", 8]
                ]}
            ]
        },
        {
            "id": 22,
            "tags": ["session window"],
            "name": "start/end predictions",
            "description": "insert event with tp_time in milliseconds",
            "steps":[
                {"statements": [
                    {"client":"python", "query_id": "701", "query_type": "stream", "terminate":"auto", "query_end_timer": 1, "query":"select id, to_string(window_start), to_string(window_end), sum(value) over (partition by id)  from session(test7_session, timestamp, 2s, [value>0, value<=50]) group by id, window_start, window_end"}
                ]},
                {"inputs": [
                    {"table_name":"test7_session","depends_on":"701", "wait":1, "data": [
                        ["dev1", "sh", 100, "\"create_time\":\"2021-11-02 20:00:00\"", "2020-02-02 20:00:01.262"],
                        ["dev2", "ca", 100, "\"create_time\":\"2021-11-02 20:00:00\"", "2020-02-02 20:00:02.262"],
                        ["dev1", "ca", 100, "\"create_time\":\"2021-11-02 20:00:00\"", "2020-02-02 20:00:02.262"],
                        ["dev1", "sh", 100, "\"create_time\":\"2021-11-02 20:00:00\"", "2020-02-02 20:00:01.263"],
                        ["dev2", "ca", 100, "\"create_time\":\"2021-11-02 20:00:04\"", "2020-02-02 20:00:01.263"],
                        ["dev1", "da", 50, "\"create_time\":\"2021-11-02 20:00:00\"", "2020-02-02 20:00:03.262"],
                        ["dev2", "ca", 50, "\"create_time\":\"2021-11-02 20:00:00\"", "2020-02-02 20:00:03.262"],
                        ["dev2", "sh", 100, "\"create_time\":\"2021-11-02 20:00:11\"", "2020-02-02 20:00:04.262"],
                        ["dev1", "sh", 100, "\"create_time\":\"2021-11-02 20:00:11\"", "2020-02-02 20:00:04.262"]
                    ]}
                ]
                }
            ],
            "expected_results": [{"query_id" : "701", "expected_results":
                [
                    ["dev1", "2020-02-02 20:00:01.262", "2020-02-02 20:00:03.263", 250],
                    ["dev2", "2020-02-02 20:00:02.262", "2020-02-02 20:00:03.263", 150]
                ]}
            ]
        },
        {
            "id": 23,
            "tags": ["session window"],
            "name": "session with emit timeout",
            "description": "session window with emit timeout",
            "steps":[
                {"statements": [
                    {"client":"python", "query_id": "701", "query_type": "stream", "terminate":"auto", "query_end_timer": 1, "query":"select id, to_string(window_start), to_string(window_end), sum(value) over (partition by id)  from session(test7_session, timestamp, 10s) group by id, window_start, window_end emit timeout 1s"},
                    {"client":"python", "query_type": "table", "depends_on": "701", "wait": 1, "query":"insert into test7_session(id, value, timestamp) values ('dev1', 1, '2020-02-02 20:00:00')"},
                    {"client":"python", "query_type": "table", "wait": 2, "query":"insert into test7_session(id, value, timestamp) values ('dev1', 2, '2020-02-02 20:00:02')"},
                    {"client":"python", "query_type": "table", "wait": 2, "kill": "701", "kill_wait": 3, "query":"insert into test7_session(id, value, timestamp) values ('dev2', 3, '2020-02-02 20:00:04')"}
                ]}
            ],
            "expected_results": [{"query_id" : "701", "expected_results":
                [
                    ["dev1", "2020-02-02 20:00:00.000", "2020-02-02 20:00:00.001", 1],
                    ["dev1", "2020-02-02 20:00:02.000", "2020-02-02 20:00:02.001", 2],
                    ["dev2", "2020-02-02 20:00:04.000", "2020-02-02 20:00:04.001", 3]
                ]}
            ]
        }
    ]
}
